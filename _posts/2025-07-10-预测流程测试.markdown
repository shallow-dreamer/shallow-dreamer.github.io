---
layout:     post
title:      "é¢„æµ‹æµç¨‹æµ‹è¯•"
subtitle:   ""
date:       2025-07-10
author:     " Shallow Dreamer"
header-img: "img/post-bg-js-version.jpg"
tags:
    - é¢„æµ‹
---

å¤ªå¥½äº†ï¼Œä½ è¿™å¥— **ã€é¢„æµ‹å‰çš„è¾“å…¥æ•°æ®è´¨æ£€ã€‘** çš„æ€è·¯æ˜¯éå¸¸ä¸“ä¸šã€éå¸¸æœ‰å¿…è¦çš„ï¼
 æˆ‘å¸®ä½ æŠŠè¿™ä¸ªéœ€æ±‚æ•´ç†æˆä¸€ä¸ª**å¯è½åœ°çš„ã€å¯æ‰§è¡Œçš„æ ‡å‡†æ–¹æ¡ˆ**ï¼Œå¹¶ç»™ä½ ç¤ºä¾‹ä»£ç ç¤ºæ„ï¼Œæ–¹ä¾¿ä½ ç›´æ¥è½åœ°åˆ°ä½ çš„å¤šè¾“å…¥å¤šè¾“å‡ºåœºæ™¯ã€‚

------

## âœ… **1ï¸âƒ£ ä½ çš„æ£€æµ‹ç›®æ ‡æ‹†è§£**

### ä½ è¦åšçš„ï¼š

| æ£€æµ‹é¡¹                     | è¦ç‚¹                                                | å¸¸ç”¨åšæ³•                                                     |
| -------------------------- | --------------------------------------------------- | ------------------------------------------------------------ |
| 1. ç¼ºå¤±å€¼æ£€æµ‹              | æ¯ä¸ªå¿…éœ€åˆ—ä¸èƒ½ç¼ºå¤±                                  | åˆ—è¡¨æ¯”å¯¹ + Null æ£€æŸ¥                                         |
| 2. åµŒå…¥å‘é‡å€¼èŒƒå›´æ£€æµ‹      | å¦‚æœæœ‰ç¦»æ•£å˜é‡åšè¿‡embeddingï¼Œæ£€æµ‹æ–°ç±»åˆ«æ˜¯å¦è¶…è®­ç»ƒé›† | æ¯”å¦‚ `Gender` åŸæœ¬åªæœ‰ {M, F}ï¼Œæ¥äº† `X` å°±è¦æŠ¥é”™æˆ–ç”¨é»˜è®¤å‘é‡ |
| 3. å½’ä¸€åŒ–/æ ‡å‡†åŒ–å€¼èŒƒå›´æ£€æµ‹ | é¢„æµ‹è¾“å…¥æ˜¯å¦è¶…å‡ºè®­ç»ƒåˆ†å¸ƒ                            | ä¿å­˜ min/maxï¼ˆå½’ä¸€åŒ–ï¼‰æˆ– z-score clipï¼ˆæ ‡å‡†åŒ–ï¼‰              |

------

## âœ… **2ï¸âƒ£ ã€è¾“å…¥åˆ—å®Œæ•´æ€§æ£€æµ‹ã€‘**

è®­ç»ƒæ—¶å¿…å¤‡åˆ—åˆ—è¡¨ï¼š

```python
# å‡è®¾ä½ çš„ç‰¹å¾åˆ—
REQUIRED_COLUMNS = ['age', 'salary', 'city', 'industry']

# é¢„æµ‹è¾“å…¥
missing_cols = [col for col in REQUIRED_COLUMNS if col not in X_test.columns]
if missing_cols:
    raise ValueError(f"âš ï¸ ç¼ºå°‘åˆ—: {missing_cols}")

# æ£€æŸ¥æ˜¯å¦æœ‰ NaN
nan_cols = X_test.columns[X_test.isnull().any()].tolist()
if nan_cols:
    raise ValueError(f"âš ï¸ å­˜åœ¨ç¼ºå¤±å€¼: {nan_cols}")
```

------

## âœ… **3ï¸âƒ£ ã€åµŒå…¥å‘é‡èŒƒå›´æ£€æµ‹ã€‘**

å¦‚æœä½ çš„æŸä¸ªåˆ†ç±»åˆ—æ˜¯éœ€è¦åš embedding çš„ï¼Œæ¯”å¦‚ `city`ï¼Œé‚£è¦ç¡®ä¿é¢„æµ‹æ—¶çš„æ–°ç±»åˆ«å­˜åœ¨äºè®­ç»ƒæ—¶ä¿å­˜çš„è¯è¡¨é‡Œã€‚

ç¤ºä¾‹ï¼š

```python
# å‡è®¾è®­ç»ƒæ—¶ä¿å­˜äº† city çš„è¯è¡¨
trained_city_vocab = {'New York', 'LA', 'Chicago'}

# é¢„æµ‹æ—¶è¾“å…¥
new_cities = set(X_test['city'].unique()) - trained_city_vocab
if new_cities:
    raise ValueError(f"âš ï¸ city åˆ—å­˜åœ¨æœªçŸ¥ç±»åˆ«: {new_cities}")
```

------

## âœ… **4ï¸âƒ£ ã€å½’ä¸€åŒ–/æ ‡å‡†åŒ–åˆ†å¸ƒæ£€æµ‹ã€‘**

### 4.1 å¦‚æœæ˜¯ `MinMaxScaler`ï¼š

ä¿å­˜è®­ç»ƒæ—¶æ¯ä¸ªç‰¹å¾çš„ min/maxï¼š

```python
scaler_params = {
    'salary': {'min': 3000, 'max': 15000},
    'age': {'min': 20, 'max': 60},
}
```

æ£€æµ‹æ˜¯å¦è¶…å‡ºï¼š

```python
for col, stats in scaler_params.items():
    val_min, val_max = X_test[col].min(), X_test[col].max()
    if val_min < stats['min'] or val_max > stats['max']:
        print(f"âš ï¸ ç‰¹å¾ {col} è¶…å‡ºè®­ç»ƒèŒƒå›´ [{stats['min']}, {stats['max']}], "
              f"å½“å‰è¾“å…¥èŒƒå›´ [{val_min}, {val_max}]")
```

------

### 4.2 å¦‚æœæ˜¯ `StandardScaler`ï¼š

ä½ ä¿å­˜äº† mean å’Œ stdï¼ŒåŒæ—¶ä¹Ÿè¦ä¿å­˜åŸå§‹ min/maxï¼Œç”¨æ¥æ£€æµ‹ï¼š

```python
scaler_params = {
    'salary': {'mean': 8000, 'std': 2000, 'min': 3000, 'max': 15000},
}

for col, stats in scaler_params.items():
    raw_min, raw_max = X_test[col].min(), X_test[col].max()
    if raw_min < stats['min'] or raw_max > stats['max']:
        print(f"âš ï¸ ç‰¹å¾ {col} è¶…å‡ºè®­ç»ƒåˆ†å¸ƒ")
```

ç„¶åå¯¹æ ‡å‡†åŒ–åçš„ z-score ä¹Ÿå¯ä»¥ clipï¼š

```python
X_scaled = (X_test - mean) / std
X_scaled = X_scaled.clip(-3, 3)
```

------

## âœ… **5ï¸âƒ£ ã€æ•´åˆç‰ˆå®Œæ•´æµç¨‹ç¤ºä¾‹ã€‘**

ä¸‹é¢æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ç»“æ„åŒ–ç¤ºä¾‹ï¼Œå±•ç¤º**å¤šè¾“å…¥å¤šè¾“å‡º + åµŒå…¥ + ç¼ºå¤±å€¼ + åˆ†å¸ƒæ£€æµ‹**æ€ä¹ˆæ”¾åˆ°ä¸€èµ·ğŸ‘‡

```python
import pandas as pd
import numpy as np

def validate_inputs(X_test: pd.DataFrame,
                    required_columns: list,
                    embedding_vocab: dict,
                    scaler_params: dict):
    # ç¼ºå¤±åˆ—æ£€æµ‹
    missing_cols = [col for col in required_columns if col not in X_test.columns]
    if missing_cols:
        raise ValueError(f"âš ï¸ ç¼ºå°‘åˆ—: {missing_cols}")

    # ç¼ºå¤±å€¼æ£€æµ‹
    nan_cols = X_test.columns[X_test.isnull().any()].tolist()
    if nan_cols:
        raise ValueError(f"âš ï¸ å­˜åœ¨ç¼ºå¤±å€¼: {nan_cols}")

    # åµŒå…¥è¯è¡¨æ£€æµ‹
    for col, vocab in embedding_vocab.items():
        new_vals = set(X_test[col].unique()) - vocab
        if new_vals:
            raise ValueError(f"âš ï¸ ç‰¹å¾ {col} æœ‰æœªçŸ¥ç±»åˆ«: {new_vals}")

    # å½’ä¸€åŒ–/æ ‡å‡†åŒ–èŒƒå›´æ£€æµ‹
    for col, stats in scaler_params.items():
        raw_min, raw_max = X_test[col].min(), X_test[col].max()
        if raw_min < stats['min'] or raw_max > stats['max']:
            print(f"âš ï¸ ç‰¹å¾ {col} è¾“å…¥è¶…å‡ºè®­ç»ƒåˆ†å¸ƒ [{stats['min']}, {stats['max']}], "
                  f"å½“å‰ [{raw_min}, {raw_max}]")

# ========== ä½¿ç”¨ç¤ºä¾‹ ==========
# å¿…éœ€åˆ—
REQUIRED_COLUMNS = ['age', 'salary', 'city']

# åµŒå…¥è¯è¡¨ç¤ºä¾‹
EMBEDDING_VOCAB = {
    'city': {'New York', 'LA', 'Chicago'}
}

# å½’ä¸€åŒ–å‚æ•°ç¤ºä¾‹
SCALER_PARAMS = {
    'age': {'min': 20, 'max': 60},
    'salary': {'min': 3000, 'max': 15000},
}

# å‡è®¾ä½ çš„é¢„æµ‹æ•°æ®
X_test = pd.DataFrame({
    'age': [25, 70],  # 70è¶…å‡º
    'salary': [8000, 20000],  # 20000è¶…å‡º
    'city': ['LA', 'Paris']   # ParisæœªçŸ¥
})

validate_inputs(X_test, REQUIRED_COLUMNS, EMBEDDING_VOCAB, SCALER_PARAMS)
```

------

## âœ… **6ï¸âƒ£ æ€»ç»“ â€” ä¸Šçº¿é¢„æµ‹å‰çš„å¿…åš 3 ä»¶äº‹**

| æ£€æµ‹é¡¹        | æ€ä¹ˆåš                       | æ˜¯å¦å¿…é¡» |
| ------------- | ---------------------------- | -------- |
| ç¼ºå¤±å€¼ / ç¼ºåˆ— | åˆ—è¡¨æ¯”å¯¹ + isnull æ£€æŸ¥       | å¿…é¡»     |
| åµŒå…¥è¯è¡¨æ£€æµ‹  | è®­ç»ƒæ—¶ä¿å­˜ç±»åˆ«é›†åˆ           | å»ºè®®     |
| åˆ†å¸ƒèŒƒå›´æ£€æµ‹  | ä¿å­˜ min/maxï¼Œåš clip æˆ–å‘Šè­¦ | å¿…é¡»     |

## 
