---
layout:     post
title:      "ldap3è¿æ¥é—®é¢˜"
subtitle:   ""
date:       2025-03-26
author:     " Shallow Dreamer"
header-img: "img/post-bg-js-version.jpg"
tags:
    - ldap3
---

åœ¨ `ldap3` ä¸­ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯é€šå¸¸æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **è¿æ¥ LDAP æœåŠ¡å™¨**
2. **è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆBindï¼‰**
3. **æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆSearchï¼‰**

ä½ è¯´åœ¨è¿æ¥å¯¹è±¡çš„â€œå¾ˆæ·±çš„ä½ç½®â€çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºé»˜è®¤æŸ¥è¯¢æœªè¿”å›æ‰€æœ‰å±æ€§ï¼Œä½ éœ€è¦æ˜ç¡®åœ°æŒ‡å®šè¦è·å–çš„å­—æ®µã€‚

------

## **è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•**

### **1. è¿æ¥å¹¶è®¤è¯**

ç¡®ä¿ä½ å·²ç»æˆåŠŸè¿æ¥åˆ° LDAP æœåŠ¡å™¨ï¼š

```python
from ldap3 import Server, Connection, ALL

server = Server('ldap://your-ldap-server.com', get_info=ALL)
conn = Connection(server, user='cn=admin,dc=example,dc=com', password='your-password', auto_bind=True)
```

------

### **2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯**

ä½¿ç”¨ `search()` æ–¹æ³•æ¥æŸ¥æ‰¾ç”¨æˆ·ï¼š

```python
search_base = "dc=example,dc=com"  # ä½ çš„ LDAP æ ¹ç›®å½•
search_filter = "(uid=johndoe)"  # è¿‡æ»¤æ¡ä»¶ï¼ŒæŸ¥æ‰¾ç‰¹å®šç”¨æˆ·
search_attributes = ["cn", "sn", "mail", "uid", "memberOf"]  # ä½ æƒ³è¦è·å–çš„å±æ€§

conn.search(search_base, search_filter, attributes=search_attributes)
```

------

### **3. è·å–æŸ¥è¯¢ç»“æœ**

ç»“æœä¼šå­˜å‚¨åœ¨ `conn.entries`ï¼Œä½ å¯ä»¥è¿™æ ·è®¿é—®ï¼š

```python
if conn.entries:
    user_entry = conn.entries[0]
    print(user_entry)  # æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯
    print("CN:", user_entry.cn)
    print("Email:", user_entry.mail)
    print("Groups:", user_entry.memberOf)
else:
    print("User not found")
```

------

### **4. è·å–æ‰€æœ‰å¯ç”¨å±æ€§**

å¦‚æœä¸ç¡®å®šæœ‰å“ªäº›å­—æ®µï¼Œå¯ä»¥è·å– `entry` çš„æ‰€æœ‰å±æ€§ï¼š

```python
if conn.entries:
    user_entry = conn.entries[0]
    print("All available attributes:")
    print(user_entry.entry_attributes)  # è·å–æ‰€æœ‰å±æ€§åç§°
```

å¦‚æœä½ çš„æŸ¥è¯¢ç»“æœåœ¨å¾ˆæ·±çš„ä½ç½®ï¼Œå°è¯• `entry.entry_to_json()`ï¼š

```python
print(user_entry.entry_to_json(indent=2))
```

------

## **å¯èƒ½çš„åŸå› åŠè§£å†³æ–¹æ¡ˆ**

### âœ… **1. æœåŠ¡å™¨é™åˆ¶äº†æŸ¥è¯¢è¿”å›çš„å­—æ®µ**

- é»˜è®¤å¯èƒ½ä¸ä¼šè¿”å›æ‰€æœ‰å­—æ®µï¼Œç¡®ä¿ä½ æ˜ç¡®è¯·æ±‚ `attributes`ã€‚
- å¦‚æœä½ æƒ³è¦æ‰€æœ‰å­—æ®µï¼Œä½¿ç”¨ `ALL_ATTRIBUTES`ï¼š

```python
from ldap3 import ALL_ATTRIBUTES
conn.search(search_base, search_filter, attributes=ALL_ATTRIBUTES)
```

### âœ… **2. `search_base` ä½ç½®ä¸å¯¹**

- ç¡®ä¿ `search_base` æ˜¯æ­£ç¡®çš„ **ç»„ç»‡å•ä½ (OU) æˆ–æ ¹è·¯å¾„**ã€‚
- ä½ å¯ä»¥ç”¨ `server.info` æŸ¥çœ‹ LDAP ç›®å½•ç»“æ„ï¼š

```python
print(server.info)
```

### âœ… **3. å¯èƒ½éœ€è¦ `SUBTREE` çº§åˆ«æœç´¢**

- é»˜è®¤ `search()` åªæŸ¥æ‰¾ç›´æ¥å­èŠ‚ç‚¹ï¼Œè¯•è¯• **é€’å½’æœç´¢**ï¼š

```python
conn.search(search_base, search_filter, search_scope="SUBTREE", attributes=ALL_ATTRIBUTES)
```

------

## **æ€»ç»“**

| **é—®é¢˜**                 | **è§£å†³æ–¹æ³•**                         |
| ------------------------ | ------------------------------------ |
| æŸ¥è¯¢ç»“æœå¤ªæ·±å±‚           | `entry.entry_to_json()` æ£€æŸ¥æ‰€æœ‰æ•°æ® |
| æ²¡æœ‰è¿”å›æ‰€æœ‰å­—æ®µ         | ç”¨ `ALL_ATTRIBUTES` è·å–å…¨éƒ¨å­—æ®µ     |
| `search_base` å¯èƒ½ä¸æ­£ç¡® | ç”¨ `server.info` æŸ¥çœ‹ LDAP ç»“æ„      |
| æŸ¥è¯¢èŒƒå›´ä¸å¤Ÿ             | ç”¨ `search_scope="SUBTREE"`          |

å¦‚æœä½ çš„ LDAP ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®® **å…ˆç”¨ `ALL_ATTRIBUTES` è·å–æ‰€æœ‰å­—æ®µ**ï¼Œç„¶åå†æŒ‘é€‰ä½ éœ€è¦çš„å­—æ®µã€‚
 å¦‚æœä»ç„¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ **è´´ä¸€ä¸‹ `entry.entry_to_json()` çš„ç»“æœ**ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æå¦‚ä½•æå–æ•°æ®ï¼ğŸš€

`entry.entry_to_json()` ä¸ºç©ºï¼Œè¯´æ˜æŸ¥è¯¢ç»“æœå¯èƒ½æœ‰é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ£€æŸ¥ï¼š

------

## **1. ç¡®ä¿æŸ¥è¯¢æˆåŠŸ**

å…ˆæ‰“å° `conn.entries` çœ‹æ˜¯å¦æœ‰è¿”å›æ•°æ®ï¼š

```python
print(conn.entries)  # åº”è¯¥æ˜¯ä¸€ä¸ªåŒ…å«ç»“æœçš„åˆ—è¡¨
```

å¦‚æœ `conn.entries` ä¸ºç©ºï¼Œå¯èƒ½çš„é—®é¢˜æœ‰ï¼š

- `search_base` ä½ç½®ä¸æ­£ç¡®
- `search_filter` ä¸åŒ¹é…ä»»ä½•ç”¨æˆ·
- è¿æ¥æœªæ­£ç¡®ç»‘å®šï¼ˆ`bind()` å¤±è´¥ï¼‰

------

## **2. æ£€æŸ¥ LDAP ç›®å½•ç»“æ„**

æœ‰æ—¶å€™ `search_base` ä¸æ­£ç¡®ä¼šå¯¼è‡´æœç´¢ä¸åˆ°ç”¨æˆ·ï¼Œä½ å¯ä»¥å…ˆ **è·å–æœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯**ï¼š

```python
print(server.info)  # äº†è§£ LDAP ç›®å½•ç»“æ„
```

å¦‚æœ `server.info` ä¸ºç©ºï¼Œè¯´æ˜è¿æ¥å¯èƒ½æœ‰é—®é¢˜ã€‚

### **æ‰‹åŠ¨è·å–æ ¹ç›®å½•**

ä½ å¯ä»¥æ‰§è¡Œï¼š

```python
conn.search('', '(objectClass=*)', attributes=['*'])  # è·å–æ‰€æœ‰æ ¹çº§åˆ«ä¿¡æ¯
print(conn.entries)
```

è¿™å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°æ­£ç¡®çš„ `search_base`ã€‚

------

## **3. ä¿®æ”¹ `search_scope` è¿›è¡Œæ·±åº¦æœç´¢**

å¦‚æœ `search_base` ä½ç½®æ­£ç¡®ï¼Œä½†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨è¾ƒæ·±ï¼Œä½ å¯ä»¥æ”¹æˆ **é€’å½’æœç´¢**ï¼š

```python
from ldap3 import SUBTREE

search_base = "dc=example,dc=com"
search_filter = "(uid=johndoe)"
conn.search(search_base, search_filter, search_scope=SUBTREE, attributes=['*'])
print(conn.entries)
```

ğŸ”¹ `SUBTREE` å…è®¸æœç´¢æ•´ä¸ªç›®å½•ï¼Œè€Œä¸ä»…ä»…æ˜¯ `search_base` ä¸‹çš„ç›´æ¥å­é¡¹ã€‚

------

## **4. ä½¿ç”¨ `ALL_ATTRIBUTES` è·å–å®Œæ•´æ•°æ®**

å¦‚æœ `conn.entries` é‡Œæœ‰æ•°æ®ï¼Œä½† `entry.entry_to_json()` ä»ä¸ºç©ºï¼Œå¯èƒ½æ˜¯ **é»˜è®¤æŸ¥è¯¢ä¸è¿”å›æ‰€æœ‰å­—æ®µ**ã€‚å°è¯•ï¼š

```python
from ldap3 import ALL_ATTRIBUTES

conn.search(search_base, search_filter, attributes=ALL_ATTRIBUTES)
print(conn.entries)
```

æˆ–è€… **æ‰‹åŠ¨è·å–æ‰€æœ‰å­—æ®µ**ï¼š

```python
if conn.entries:
    user_entry = conn.entries[0]
    print(user_entry.entry_attributes)  # åˆ—å‡ºæ‰€æœ‰å¯ç”¨å­—æ®µ
```

------

## **5. è¿æ¥é—®é¢˜**

å¦‚æœæ‰€æœ‰æ­¥éª¤éƒ½å¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯è¿æ¥æœªæ­£ç¡®å»ºç«‹ã€‚å°è¯•ï¼š

```python
print(conn.bind())  # åº”è¯¥è¿”å› True
```

å¦‚æœè¿”å› `False`ï¼Œè¯´æ˜ `user` å’Œ `password` å¯èƒ½ä¸æ­£ç¡®ï¼Œéœ€è¦æ£€æŸ¥ LDAP æœåŠ¡å™¨çš„è®¤è¯æ–¹å¼ã€‚

------

### **æ€»ç»“**

| **é—®é¢˜**                     | **è§£å†³æ–¹æ¡ˆ**                            |
| ---------------------------- | --------------------------------------- |
| `conn.entries` ä¸ºç©º          | æ£€æŸ¥ `search_base`ï¼Œå°è¯• `SUBTREE` æœç´¢ |
| `entry.entry_to_json()` ä¸ºç©º | ä½¿ç”¨ `ALL_ATTRIBUTES` è·å–æ‰€æœ‰å­—æ®µ      |
| `conn.bind()` ä¸º `False`     | ç¡®ä¿ LDAP ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®              |

å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œä½ å¯ä»¥æŠŠ `print(conn.entries)` çš„è¾“å‡ºè´´å‡ºæ¥ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æé—®é¢˜ï¼ğŸš€

`conn.entries` ä¸ºç©ºï¼Œè¯´æ˜æœç´¢ **æ²¡æœ‰è¿”å›ä»»ä½•ç»“æœ**ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½çš„åŸå› ï¼š

------

## **1. ç¡®ä¿ `search_base` ä½ç½®æ­£ç¡®**

LDAP ç›®å½•æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œ`search_base` å¿…é¡»æŒ‡å‘æ­£ç¡®çš„æ ¹è·¯å¾„ã€‚
 ä½ å¯ä»¥ **å…ˆè·å–æ ¹ç›®å½•** æ¥ç¡®è®¤ï¼š

```python
conn.search('', '(objectClass=*)', attributes=['*'])
print(conn.entries)
```

å¦‚æœè¿™æ¡å‘½ä»¤è¿”å› **ç©ºåˆ—è¡¨**ï¼Œè¯´æ˜ä½ çš„ `bind()` å¤±è´¥äº†ï¼Œæˆ–è€…ä½ çš„ LDAP æœåŠ¡å™¨æœ‰è®¿é—®é™åˆ¶ã€‚

å¦‚æœå®ƒè¿”å›äº†ä¸€äº›æ•°æ®ï¼Œé‚£å°±è¯´æ˜ `search_base` å¯èƒ½å†™é”™äº†ã€‚
 ä½ å¯ä»¥å°è¯• **åˆ—å‡ºæ‰€æœ‰ç»„ç»‡å•ä½ (OU)**ï¼š

```python
search_base = "dc=example,dc=com"  # å¯èƒ½éœ€è¦è°ƒæ•´
search_filter = "(objectClass=organizationalUnit)"
conn.search(search_base, search_filter, attributes=['dn'])
print(conn.entries)  # è¿™ä¼šåˆ—å‡ºæ‰€æœ‰ OUï¼ˆç»„ç»‡å•å…ƒï¼‰
```

ç„¶åä½ å¯ä»¥å°è¯•ä½¿ç”¨è¿”å›çš„ `dn` ä½œä¸º `search_base`ã€‚

------

## **2. æ£€æŸ¥ `search_filter` æ˜¯å¦åŒ¹é…ç”¨æˆ·**

æœ‰æ—¶å€™ `search_filter` å¯èƒ½å†™é”™ï¼Œå¯¼è‡´æœç´¢ä¸åˆ°ç”¨æˆ·ã€‚å°è¯•ä½¿ç”¨ **å®½æ¾çš„è¿‡æ»¤æ¡ä»¶**ï¼š

```python
search_base = "dc=example,dc=com"  # ä½ çš„ LDAP ç›®å½•æ ¹
search_filter = "(objectClass=person)"  # æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·
conn.search(search_base, search_filter, attributes=['cn', 'uid'])
print(conn.entries)
```

å¦‚æœè¿™æ¡æŸ¥è¯¢è¿”å›ç»“æœï¼Œè¯´æ˜ `search_filter` éœ€è¦ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°è¯•ï¼š

```python
search_filter = "(|(uid=johndoe)(cn=John Doe))"  # ä½¿ç”¨ OR é€»è¾‘æŸ¥æ‰¾
```

------

## **3. ä½¿ç”¨ `SUBTREE` çº§åˆ«æœç´¢**

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`ldap3` å¯èƒ½åªæœç´¢ **ç›´æ¥å­çº§**ï¼Œä½†ç”¨æˆ·å¯¹è±¡å¯èƒ½åœ¨æ›´æ·±çš„å±‚çº§ã€‚å°è¯• **é€’å½’æœç´¢**ï¼š

```python
from ldap3 import SUBTREE

conn.search(search_base, search_filter, search_scope=SUBTREE, attributes=['cn', 'uid'])
print(conn.entries)
```

å¦‚æœ `search_scope` è®¾ä¸º `SUBTREE` ä¹‹åæœ‰è¿”å›å€¼ï¼Œè¯´æ˜ä¹‹å‰çš„æœç´¢å±‚çº§ä¸å¤Ÿæ·±ã€‚

------

## **4. ç¡®ä¿ `bind()` æˆåŠŸ**

å¦‚æœ `bind()` å¤±è´¥ï¼Œæ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šè¿”å›ç©ºåˆ—è¡¨ã€‚æ£€æŸ¥ä½ çš„è®¤è¯ï¼š

```python
print(conn.bind())  # True è¡¨ç¤ºç»‘å®šæˆåŠŸï¼ŒFalse è¯´æ˜è®¤è¯å¤±è´¥
```

å¦‚æœ `False`ï¼Œå¯èƒ½çš„åŸå› ï¼š

- **ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯**ï¼šç¡®ä¿ `user` å’Œ `password` æ˜¯æ­£ç¡®çš„ **å®Œæ•´ DN**ï¼ˆå¦‚ `cn=admin,dc=example,dc=com`ï¼‰ã€‚
- **åŒ¿åç»‘å®šè¢«ç¦æ­¢**ï¼šå¦‚æœ LDAP æœåŠ¡å™¨ä¸å…è®¸åŒ¿åç™»å½•ï¼Œéœ€è¦æä¾›åˆæ³•çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

å¦‚æœä½ çš„ LDAP å…è®¸åŒ¿åç»‘å®šï¼Œä½ å¯ä»¥å°è¯•ï¼š

```python
conn = Connection(server, auto_bind=True)  # å°è¯•åŒ¿åç»‘å®š
```

------

## **5. æ£€æŸ¥ LDAP æœåŠ¡å™¨æ—¥å¿—**

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•æ‰¾åˆ°ç”¨æˆ·ï¼Œå¯èƒ½æ˜¯ **LDAP æœåŠ¡å™¨æœ‰æŸ¥è¯¢é™åˆ¶**ã€‚ä½ å¯ä»¥ï¼š

- è”ç³» LDAP ç®¡ç†å‘˜ï¼Œç¡®è®¤ä½ çš„è´¦å·æ˜¯å¦æœ‰ **æŸ¥è¯¢æƒé™**ã€‚
- æ£€æŸ¥ LDAP æœåŠ¡å™¨æ˜¯å¦æœ‰ **IP è®¿é—®é™åˆ¶**ã€‚
- åœ¨æœåŠ¡å™¨ç«¯æŸ¥çœ‹æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ **è®¿é—®è¢«æ‹’ç»** çš„è®°å½•ã€‚

------

### **æ€»ç»“**

| **å¯èƒ½é—®é¢˜**             | **è§£å†³æ–¹æ¡ˆ**                                                 |
| ------------------------ | ------------------------------------------------------------ |
| `search_base` é”™è¯¯       | å…ˆæŸ¥è¯¢ `dc=example,dc=com` çš„ `objectClass=organizationalUnit` |
| `search_filter` è¿‡äºä¸¥æ ¼ | è¯•è¯• `(objectClass=person)` æˆ– `(                            |
| æœç´¢èŒƒå›´ä¸å¤Ÿ             | æ”¹ä¸º `search_scope=SUBTREE`                                  |
| `bind()` å¤±è´¥            | `print(conn.bind())` æ£€æŸ¥æ˜¯å¦ `True`                         |
| æœåŠ¡å™¨é™åˆ¶               | æ£€æŸ¥ LDAP è®¿é—®æƒé™ï¼Œè”ç³»ç®¡ç†å‘˜                               |

------

å¦‚æœä½ æ‰§è¡Œ `print(conn.entries)` ä¹‹å **ä»ç„¶ä¸ºç©º**ï¼Œè¯· **æä¾› `search_base`ã€`search_filter` ä»¥åŠ `conn.bind()` çš„ç»“æœ**ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†ææ›´å…·ä½“çš„é—®é¢˜ï¼ğŸš€

å¦‚æœ `conn.bind()` è¿”å› `True`ï¼Œè€Œ `conn.search()` å®é™…ä¸Šæ˜¯æˆåŠŸçš„ï¼ˆåœ¨è¿”å›çš„æ•°æ®çš„æ·±å±‚ä½ç½®èƒ½çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œä½† `conn.entries` ä¸ºç©ºï¼Œé‚£ä¹ˆå¯èƒ½çš„é—®é¢˜æœ‰ä»¥ä¸‹å‡ ç§ï¼š

------

## **1. ç¡®ä¿ `search()` å®é™…ä¸Šæ‰¾åˆ°äº†æ•°æ®**

è™½ç„¶ `conn.entries` ä¸ºç©ºï¼Œä½† `conn.response` å¯èƒ½å·²ç»åŒ…å«äº†æ•°æ®ã€‚ä½ å¯ä»¥æ‰“å° `conn.response` æ¥æŸ¥çœ‹å®Œæ•´çš„è¿”å›å†…å®¹ï¼š

```python
import json

print(json.dumps(conn.response, indent=2))  # ä»¥ JSON æ ¼å¼æ‰“å°å®Œæ•´å“åº”æ•°æ®
```

çœ‹çœ‹è¿”å›çš„æ•°æ®ç»“æ„ï¼Œç¡®è®¤ç”¨æˆ·ä¿¡æ¯æ˜¯å­˜åœ¨çš„ã€‚

------

## **2. å¯èƒ½ `search()` ç»“æœè¢« `referrals` å¹²æ‰°**

LDAP å¯èƒ½è¿”å› **å¼•ç”¨ (referrals)**ï¼Œè¿™äº›æ•°æ®å¯èƒ½ä¸ä¼šè‡ªåŠ¨å­˜å…¥ `conn.entries`ã€‚ä½ å¯ä»¥æ£€æŸ¥ï¼š

```python
print(conn.result)  # æ£€æŸ¥ LDAP æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ä¿¡æ¯
```

å¦‚æœ `result['description']` æ˜¯ `"referral"`, è¯´æ˜æŸ¥è¯¢è¢«é‡å®šå‘äº†ï¼Œéœ€è¦ç¦ç”¨å¼•ç”¨ï¼š

```python
conn = Connection(server, user=user_dn, password=password, auto_bind=True, check_names=True, return_empty_attributes=True)
```

ç„¶åé‡æ–°æ‰§è¡Œ `search()`ã€‚

------

## **3. ç›´æ¥è®¿é—® `conn.response`**

æœ‰æ—¶ LDAP æœåŠ¡å™¨è¿”å›çš„æ•°æ®ä¸ä¼šè‡ªåŠ¨å¡«å……åˆ° `conn.entries`ï¼Œä½†å®ƒä»ç„¶å­˜å‚¨åœ¨ `conn.response` é‡Œã€‚
 ä½ å¯ä»¥æ‰‹åŠ¨è§£æ `conn.response`ï¼š

```python
for entry in conn.response:
    if 'dn' in entry:
        print("DN:", entry['dn'])
    if 'attributes' in entry:
        print("Attributes:", entry['attributes'])
```

è¿™ä¼šéå†æ‰€æœ‰æŸ¥è¯¢åˆ°çš„æ•°æ®å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚

------

## **4. å¼ºåˆ¶ä½¿ç”¨ `search_scope=SUBTREE`**

æœ‰æ—¶ `search()` å¯èƒ½é»˜è®¤åªæŸ¥æ‰¾ç›´æ¥å­é¡¹ï¼Œè€Œä½ çš„ç”¨æˆ·ä¿¡æ¯å¯èƒ½åœ¨æ›´æ·±çš„å±‚çº§ã€‚ç¡®ä¿ä½¿ç”¨ï¼š

```python
from ldap3 import SUBTREE

conn.search(search_base, search_filter, search_scope=SUBTREE, attributes=['*'])
```

------

## **5. ç¡®ä¿ `attributes=['\*']` ä»¥è·å–æ‰€æœ‰å­—æ®µ**

æŸäº› LDAP æœåŠ¡å™¨å¯èƒ½é™åˆ¶è¿”å›å­—æ®µã€‚å¦‚æœ `attributes` æ²¡æœ‰æŒ‡å®šï¼Œå¯èƒ½å¯¼è‡´ `entries` ä¸ºç©ºï¼š

```python
conn.search(search_base, search_filter, attributes=['*'])  # è·å–æ‰€æœ‰å¯ç”¨å­—æ®µ
```

å¦‚æœä»ç„¶æ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š

```python
conn.search(search_base, search_filter, attributes=['cn', 'uid', 'mail'])
```

------

### **æ€»ç»“**

| **é—®é¢˜**                                         | **è§£å†³æ–¹æ¡ˆ**                                 |
| ------------------------------------------------ | -------------------------------------------- |
| `conn.entries` ä¸ºç©ºï¼Œä½†æ•°æ®åœ¨ `conn.response` é‡Œ | `print(json.dumps(conn.response, indent=2))` |
| LDAP æœåŠ¡å™¨è¿”å› `"referral"`                     | `return_empty_attributes=True`               |
| æ•°æ®æ²¡æœ‰æ­£ç¡®å¡«å……                                 | éå† `conn.response` æ‰‹åŠ¨æå–                |
| æœç´¢èŒƒå›´ä¸å¤Ÿ                                     | `search_scope=SUBTREE`                       |
| æœåŠ¡å™¨é™åˆ¶è¿”å›å­—æ®µ                               | `attributes=['*']`                           |

**ğŸ”¹ å°è¯• `print(json.dumps(conn.response, indent=2))` çœ‹çœ‹å…·ä½“è¿”å›å†…å®¹ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åˆ†ææ›´å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼** ğŸš€

