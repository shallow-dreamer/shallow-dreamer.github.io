---
layout:     post
title:      "antv x6æµ‹è¯•"
subtitle:   ""
date:       2025-08-18
author:     " Shallow Dreamer"
header-img: "img/post-bg-js-version.jpg"
tags:
    - antv x6
---



æ²¡é—®é¢˜ï¼ä¸‹é¢ç»™ä½ ä¸€å¥—**å®Œæ•´å¯è½åœ°çš„ Vue3 + antv/x6 å›¾ç¼–è¾‘å™¨è„šæ‰‹æ¶**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š**ä¸ X6 è§£è€¦ / é«˜åº¦å¯æ‰©å±• / æ³¨é‡Šè¯¦ç»†**ã€‚ä½ å¯ä»¥æŠŠè¿™äº›æ–‡ä»¶ç›´æ¥æ”¾è¿›ä¸€ä¸ª Vite + Vue3 + TS é¡¹ç›®é‡Œè¿è¡Œï¼ˆæˆ‘ç»™äº†æœ€å°ä¾èµ–æ¸…å•ï¼‰ã€‚
 åŠŸèƒ½ç‚¹ï¼šè‡ªå®šä¹‰â€œå…ƒå™¨ä»¶â€èŠ‚ç‚¹ï¼ˆSVG å›¾æ ‡ï¼‰ã€ä¸šåŠ¡æ•°æ®ç»‘å®šã€ä¸šåŠ¡é¢æ¿è”åŠ¨ã€å‘½ä»¤æ€»çº¿ã€äº‹ä»¶æ€»çº¿ã€èŠ‚ç‚¹æ³¨å†Œè¡¨ã€ç«¯å£ä¸è¿çº¿æ ¡éªŒã€æŒä¹…åŒ–æ¥å£å¯æ›¿æ¢ã€‚

------

# 1) æœ€å°ä¾èµ–

```json
// package.jsonï¼ˆå…³é”®ä¾èµ–ï¼‰
{
  "name": "x6-vue3-editor",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@antv/x6": "^2.16.1",
    "mitt": "^3.0.1",
    "vue": "^3.4.0"
  },
  "devDependencies": {
    "typescript": "^5.5.4",
    "vite": "^5.2.0",
    "@vitejs/plugin-vue": "^5.0.0",
    "vue-tsc": "^2.0.22"
  }
}
```

------

# 2) å…¥å£æ–‡ä»¶

```ts
// src/main.ts
import { createApp } from 'vue'
import App from './App.vue'
import './styles.css' // å¯é€‰ï¼šåŸºæœ¬æ ·å¼
createApp(App).mount('#app')
<!-- src/App.vue -->
<template>
  <DiagramEditor />
</template>
<script setup lang="ts">
import DiagramEditor from './views/DiagramEditor.vue'
</script>
// src/env.d.ts
/// <reference types="vite/client" />
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'node:path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  }
})
```

------

# 3) ç±»å‹ä¸å¸¸é‡ï¼ˆè§£è€¦ X6 çš„å…¬å…±å¥‘çº¦ï¼‰

```ts
// src/core/types.ts
/**
 * ä¸šåŠ¡æ•°æ®çš„åŸºç¡€ç»“æ„ï¼šä½ å¯ä»¥æ‰©å±•æˆä½ çš„é¢†åŸŸæ¨¡å‹
 */
export interface BizData {
  id: string
  type: string
  label?: string
  payload?: Record<string, any> // ä»»æ„ä¸šåŠ¡å­—æ®µ
}

/**
 * æ–°å¢èŠ‚ç‚¹çš„å…¥å‚ï¼ˆä¸ X6 æ— å…³ï¼‰
 */
export interface CreateNodeInput {
  type: string                 // èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ï¼šresistorï¼‰
  position: { x: number; y: number }
  bizData: BizData             // ä¸šåŠ¡æ•°æ®ï¼ˆå°†å­˜å‚¨åˆ° node.dataï¼‰
}

/**
 * å¯æ›¿æ¢çš„æŒä¹…åŒ–æ¥å£ï¼›é»˜è®¤æä¾› localStorage å®ç°
 */
export interface Persistence {
  save(diagramId: string, json: string): Promise<void>
  load(diagramId: string): Promise<string | null>
}

/**
 * ç«¯å£å®šä¹‰ï¼ˆè§£è€¦åï¼Œä½ çš„èŠ‚ç‚¹ç±»å†æ˜ å°„åˆ° X6 ç«¯å£ï¼‰
 */
export interface PortSpec {
  id: string
  group: 'in' | 'out'
  // ä½ è¿˜å¯ä»¥åŠ å…¥ç”µæ°”å‚æ•°ã€æ–¹å‘ã€é”šç‚¹ç­‰é¢†åŸŸå±æ€§
}
```

------

# 4) äº‹ä»¶æ€»çº¿ï¼ˆä¸šåŠ¡ â†” å›¾ çš„ä½è€¦åˆé€šä¿¡ï¼‰

```ts
// src/core/graph/GraphEvents.ts
import mitt from 'mitt'
import type { BizData } from '../types'

type Events = {
  'node:click': { id: string; biz: BizData }
  'node:contextmenu': { id: string; biz: BizData; event: MouseEvent }
  'selection:changed': { nodes: BizData[] }
  'edge:connected': { sourceId: string; targetId: string }
  'graph:loaded': { count: number }
}

export const GraphEvents = mitt<Events>()
```

------

# 5) å‘½ä»¤æ€»çº¿ï¼ˆå¯æ’å…¥ä¸­é—´ä»¶ï¼Œç»Ÿä¸€åšæ—¥å¿—/æƒé™/åŸ‹ç‚¹ï¼‰

```ts
// src/core/command/CommandBus.ts
type CommandHandler<P, R> = (payload: P) => Promise<R> | R
type Next<P, R> = (payload: P) => Promise<R>

export type Middleware<P, R> = (payload: P, next: Next<P, R>) => Promise<R>

export class CommandBus {
  private handlers = new Map<string, CommandHandler<any, any>>()
  private middlewares: Middleware<any, any>[] = []

  use<P, R>(mw: Middleware<P, R>) {
    this.middlewares.push(mw)
  }

  register<P, R>(name: string, handler: CommandHandler<P, R>) {
    this.handlers.set(name, handler)
  }

  async exec<P, R>(name: string, payload: P): Promise<R> {
    const handler = this.handlers.get(name)
    if (!handler) throw new Error(`[CommandBus] Handler not found: ${name}`)

    // ç»„è£…ä¸­é—´ä»¶é“¾
    const composed = this.middlewares.reduceRight<Next<P, R>>(
      (next, mw) => (p: P) => mw(p, next),
      (p: P) => Promise.resolve(handler(p))
    )
    return composed(payload)
  }
}

// å•ä¾‹å¯¼å‡º
export const commandBus = new CommandBus()

// ç¤ºä¾‹ä¸­é—´ä»¶ï¼šæ—¥å¿— + é”™è¯¯å…œåº•
commandBus.use(async (payload, next) => {
  console.debug('[CommandBus] ->', payload)
  try {
    const res = await next(payload)
    console.debug('[CommandBus] <-', res)
    return res
  } catch (e) {
    console.error('[CommandBus] !!', e)
    throw e
  }
})
```

------

# 6) æŒä¹…åŒ–ï¼ˆé»˜è®¤ LocalStorageï¼Œå¯æ¢æˆ HTTP/S3ï¼‰

```ts
// src/core/persistence/LocalStoragePersistence.ts
import type { Persistence } from '../types'

export class LocalStoragePersistence implements Persistence {
  async save(diagramId: string, json: string) {
    localStorage.setItem(`diagram:${diagramId}`, json)
  }
  async load(diagramId: string) {
    return localStorage.getItem(`diagram:${diagramId}`)
  }
}
```

------

# 7) èŠ‚ç‚¹åŸºç±» + èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼ˆä¸ X6 æ˜ å°„é›†ä¸­åœ¨è¿™é‡Œï¼‰

```ts
// src/core/nodes/BaseNode.ts
import type { BizData, PortSpec } from '../types'

/**
 * ä¸ X6 æ— å…³çš„â€œé¢†åŸŸèŠ‚ç‚¹â€æŠ½è±¡ã€‚
 * å­ç±»åªå…³å¿ƒä¸šåŠ¡å±æ€§å’Œç«¯å£å®šä¹‰ï¼Œå¦‚ä½•æ¸²æŸ“äº¤ç»™é€‚é…å™¨å»åšã€‚
 */
export abstract class BaseNode {
  constructor(
    protected biz: BizData,
    protected position: { x: number; y: number }
  ) {}

  /** æ˜¾ç¤ºåç§°ï¼ˆç”¨äºå›¾ä¸Š labelï¼‰ */
  abstract displayName(): string
  /** å›¾æ ‡è·¯å¾„ï¼ˆSVGï¼‰æˆ–å†…è” SVG */
  abstract icon(): string
  /** ç«¯å£æ¸…å•ï¼ˆin/outï¼‰ */
  abstract ports(): PortSpec[]

  /** æä¾›é»˜è®¤å°ºå¯¸ï¼Œä¹Ÿå¯è®©å­ç±»è¦†å†™ */
  size() { return { width: 96, height: 48 } }

  /** ä¸šåŠ¡æ•°æ®æš´éœ²ï¼ˆç”¨äºå¤–éƒ¨æŒä¹…åŒ–/é¢æ¿æ˜¾ç¤ºï¼‰ */
  toBiz(): BizData { return this.biz }

  /** ç”Ÿæˆâ€œå¼•æ“æ— å…³â€çš„ç»“æ„ï¼Œäº¤ç”± X6 é€‚é…å™¨ç¿»è¯‘ */
  toEngineAgnostic() {
    return {
      type: this.biz.type,
      position: this.position,
      size: this.size(),
      label: this.displayName(),
      icon: this.icon(),
      ports: this.ports(),
      biz: this.toBiz(),
    }
  }
}
// src/core/nodes/components/ResistorNode.ts
import { BaseNode } from '../BaseNode'
import type { BizData, PortSpec } from '../../types'

export class ResistorNode extends BaseNode {
  displayName() { return this.biz.label ?? 'ç”µé˜»' }
  icon() { return '/icons/resistor.svg' } // æ”¾åˆ° public/icons ä¸‹
  ports(): PortSpec[] {
    // ç®€åŒ–ï¼šå·¦å³å„ä¸€ä¸ªç«¯å£
    return [
      { id: `${this.biz.id}:in`, group: 'in' },
      { id: `${this.biz.id}:out`, group: 'out' },
    ]
  }
}
// src/core/nodes/components/CapacitorNode.ts
import { BaseNode } from '../BaseNode'
import type { PortSpec } from '../../types'

export class CapacitorNode extends BaseNode {
  displayName() { return this.biz.label ?? 'ç”µå®¹' }
  icon() { return '/icons/capacitor.svg' }
  ports(): PortSpec[] {
    return [
      { id: `${this.biz.id}:in`, group: 'in' },
      { id: `${this.biz.id}:out`, group: 'out' },
    ]
  }
}
// src/core/graph/NodeRegistry.ts
import type { BaseNode } from '../nodes/BaseNode'

/**
 * èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼šé¢†åŸŸèŠ‚ç‚¹ç±»çš„â€œå·¥å‚ç›®å½•â€
 * â€”â€”æ–°å¢èŠ‚ç‚¹ï¼Œåªéœ€æ–°å»ºç±» + registerã€‚
 */
const registry: Record<string, new (...args: any[]) => BaseNode> = {}

export const NodeRegistry = {
  register(type: string, ctor: new (...args: any[]) => BaseNode) {
    registry[type] = ctor
  },
  create(type: string, ...args: any[]): BaseNode {
    const ctor = registry[type]
    if (!ctor) throw new Error(`[NodeRegistry] Unregistered: ${type}`)
    return new ctor(...args)
  },
  has(type: string) {
    return !!registry[type]
  }
}
```

> åœ¨å…¥å£å¤„å®Œæˆæ³¨å†Œï¼ˆè§ä¸‹æ–¹ GraphManager åˆå§‹åŒ–ï¼‰ã€‚

------

# 8) X6 é€‚é…å™¨ä¸ Graph ç®¡ç†å™¨ï¼ˆå”¯ä¸€æ¥è§¦ X6 çš„å±‚ï¼‰

```ts
// src/core/graph/X6Adapter.ts
import type { Graph } from '@antv/x6'
import type { PortSpec } from '../types'

/**
 * å°†â€œå¼•æ“æ— å…³â€çš„èŠ‚ç‚¹æ•°æ®ï¼Œè½¬æ¢æˆ X6 NodeConfigã€‚
 * â€”â€”è‹¥æœªæ¥æ›´æ¢å¼•æ“ï¼Œåªéœ€æ›¿æ¢æœ¬æ–‡ä»¶çš„å®ç°ã€‚
 */
export function toX6NodeConfig(agnostic: {
  type: string
  position: { x: number; y: number }
  size: { width: number; height: number }
  label: string
  icon: string
  ports: PortSpec[]
  biz: any
}) {
  const { position, size, label, icon, ports, biz } = agnostic

  // X6 ç«¯å£ç»„ä¸å¸ƒå±€ï¼šå·¦å³ä¸¤ç»„
  const portGroups = {
    in: { position: 'left' as const, attrs: { circle: { r: 4, magnet: true } } },
    out:{ position: 'right' as const, attrs: { circle: { r: 4, magnet: true } } }
  }

  return {
    shape: 'rect',
    x: position.x,
    y: position.y,
    width: size.width,
    height: size.height,
    data: biz, // ä¸šåŠ¡æ•°æ®æ”¾åœ¨ data
    attrs: {
      body: { stroke: '#1f2937', fill: '#fff', rx: 6, ry: 6 },
      label: { text: label, fontSize: 12, refY: 0.5, refY2: 0 },
      image: { 'xlink:href': icon, width: 20, height: 20, x: 8, y: 14 }
    },
    ports: {
      groups: portGroups,
      items: ports.map(p => ({ id: p.id, group: p.group }))
    }
  }
}

/**
 * X6 å±‚çš„è¿çº¿æ ¡éªŒè§„åˆ™ï¼šåªå…è®¸ out â†’ inã€‚
 */
export function createConnectingOptions() {
  return {
    allowBlank: false,
    allowLoop: false,
    allowNode: false,
    highlight: true,
    snap: true,
    validateConnection({ sourcePort, targetPort }) {
      // ç®€å•æ ¡éªŒï¼šç«¯å£å‘½åé‡ŒåŒ…å« :out â†’ :in
      return !!(sourcePort?.id?.includes(':out') && targetPort?.id?.includes(':in'))
    }
  }
}
// src/core/graph/GraphManager.ts
import { Graph } from '@antv/x6'
import { GraphEvents } from './GraphEvents'
import { NodeRegistry } from './NodeRegistry'
import { toX6NodeConfig, createConnectingOptions } from './X6Adapter'
import type { CreateNodeInput, Persistence } from '../types'

export class GraphManager {
  private graph!: Graph
  private persistence: Persistence
  private diagramId: string

  constructor(opts: { container: HTMLElement; persistence: Persistence; diagramId: string }) {
    this.persistence = opts.persistence
    this.diagramId = opts.diagramId
    this.graph = new Graph({
      container: opts.container,
      grid: { size: 10, visible: true },
      panning: true,
      mousewheel: { enabled: true, modifiers: ['ctrl'] },
      connecting: createConnectingOptions(),
      selecting: { enabled: true, multiple: true, rubberband: true },
      history: { enabled: true }
    })

    this.bindEvents()
  }

  /** ç»Ÿä¸€ç»‘å®š X6 äº‹ä»¶ï¼Œå¹¶è½¬æ¢æˆä¸šåŠ¡å±‚äº‹ä»¶ */
  private bindEvents() {
    this.graph.on('node:click', ({ node }) => {
      const biz = node.getData()
      GraphEvents.emit('node:click', { id: node.id, biz })
    })

    this.graph.on('node:contextmenu', ({ node, e }) => {
      e.preventDefault()
      const biz = node.getData()
      GraphEvents.emit('node:contextmenu', { id: node.id, biz, event: e })
    })

    this.graph.on('selection:changed', () => {
      const nodes = this.graph.getSelectedCells()
        .filter(c => c.isNode())
        .map(n => (n as any).getData())
      GraphEvents.emit('selection:changed', { nodes })
    })

    this.graph.on('edge:connected', ({ isNew, edge }) => {
      if (!isNew) return
      const sourceId = edge.getSourceCellId()
      const targetId = edge.getTargetCellId()
      GraphEvents.emit('edge:connected', { sourceId, targetId })
    })
  }

  /** æ–°å¢èŠ‚ç‚¹ï¼ˆé¢†åŸŸ â†’ å¼•æ“æ— å…³ â†’ X6ï¼‰ */
  addNode(input: CreateNodeInput) {
    const node = NodeRegistry.create(input.type, input.bizData, input.position)
    const config = toX6NodeConfig(node.toEngineAgnostic())
    this.graph.addNode(config)
    return config
  }

  /** ä¿å­˜åˆ°æŒä¹…åŒ– */
  async save() {
    const json = JSON.stringify(this.graph.toJSON())
    await this.persistence.save(this.diagramId, json)
  }

  /** ä»æŒä¹…åŒ–åŠ è½½ */
  async load() {
    const json = await this.persistence.load(this.diagramId)
    if (json) {
      this.graph.fromJSON(JSON.parse(json))
      GraphEvents.emit('graph:loaded', { count: this.graph.getNodes().length })
    }
  }

  /** å¯¼å‡º PNG/SVG ç­‰ï¼Œå¯ç»§ç»­æ‰©å±• */
  async exportPNG() {
    return await this.graph.toPNG({ backgroundColor: '#ffffff' })
  }

  /** å¯¹å¤–æš´éœ² Graph å®ä¾‹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ */
  get raw() { return this.graph }
}
```

------

# 9) ä¸šåŠ¡æœåŠ¡ï¼ˆä¸å›¾æ— å…³ï¼Œåšæ•°æ®åŠ å·¥/æ ¡éªŒ/è¿œç«¯è¯·æ±‚ç­‰ï¼‰

```ts
// src/core/services/BusinessService.ts
import type { BizData } from '../types'

/**
 * æ¨¡æ‹Ÿä¸šåŠ¡æœåŠ¡ï¼šåœ¨çœŸå®é¡¹ç›®é‡Œï¼Œè¿™é‡Œå¯ä»¥å‘ HTTPã€åšæƒé™æ ¡éªŒã€å®¡è®¡æ—¥å¿—ç­‰ã€‚
 */
export class BusinessService {
  getNodeTitle(biz: BizData) {
    // ç»Ÿä¸€å‘½åè§„èŒƒï¼šå¯åœ¨è¿™é‡Œå†³å®š label å±•ç°
    return biz.label ?? `${biz.type} #${biz.id.slice(-4)}`
  }

  validateAddNode(biz: BizData) {
    // ä¾‹ï¼šåŒä¸€ä¸ªå›¾é‡Œä¸å…è®¸é‡å¤ id
    if (!biz.id) throw new Error('biz.id required')
    return true
  }
}
```

------

# 10) ç»„ä»¶ï¼šç”»å¸ƒä¸é¡µé¢

```vue
<!-- src/components/GraphCanvas.vue -->
<template>
  <div ref="container" class="graph-canvas"></div>
</template>

<script setup lang="ts">
import { onMounted, ref, onBeforeUnmount, watchEffect } from 'vue'
import { GraphManager } from '@/core/graph/GraphManager'
import { LocalStoragePersistence } from '@/core/persistence/LocalStoragePersistence'
import { GraphEvents } from '@/core/graph/GraphEvents'
import { commandBus } from '@/core/command/CommandBus'

// å°† GraphManager æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
const container = ref<HTMLDivElement>()
let manager: GraphManager | null = null

onMounted(async () => {
  if (!container.value) return
  manager = new GraphManager({
    container: container.value,
    persistence: new LocalStoragePersistence(),
    diagramId: 'demo-diagram-001'
  })
  await manager.load()

  // æ³¨å†Œå‘½ä»¤ï¼šæ·»åŠ èŠ‚ç‚¹ï¼ˆé¡µé¢/å·¥å…·æ å¯é€šè¿‡ CommandBus è§¦å‘ï¼‰
  commandBus.register('node.add', (payload: {
    type: string; x: number; y: number; biz: any
  }) => {
    return manager!.addNode({
      type: payload.type,
      position: { x: payload.x, y: payload.y },
      bizData: payload.biz
    })
  })

  // æ³¨å†Œå‘½ä»¤ï¼šä¿å­˜å›¾
  commandBus.register('graph.save', async () => {
    await manager!.save()
    return true
  })
})

onBeforeUnmount(() => {
  // å¦‚éœ€é”€æ¯é‡Šæ”¾äº‹ä»¶ç›‘å¬ï¼Œè¿™é‡Œå¤„ç†ï¼ˆX6 å†…éƒ¨å·²åšå¤§éƒ¨åˆ†æ¸…ç†ï¼‰
})
</script>

<style scoped>
.graph-canvas {
  width: 100%;
  height: 100%;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
}
</style>
<!-- src/views/DiagramEditor.vue -->
<template>
  <div class="page">
    <div class="left">
      <div class="toolbar">
        <button @click="addResistor">+ ç”µé˜»</button>
        <button @click="addCapacitor">+ ç”µå®¹</button>
        <button @click="save">ğŸ’¾ ä¿å­˜</button>
      </div>
      <GraphCanvas />
    </div>

    <aside class="right">
      <h3>ä¸šåŠ¡é¢æ¿</h3>
      <div v-if="selected">
        <div class="row"><b>ID</b><span>{{ selected.id }}</span></div>
        <div class="row"><b>ç±»å‹</b><span>{{ selected.type }}</span></div>
        <div class="row"><b>æ ‡é¢˜</b><span>{{ selected.label }}</span></div>
        <pre class="payload">{{ selected.payload }}</pre>
      </div>
      <div v-else>ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹ä¸šåŠ¡æ•°æ®</div>
    </aside>
  </div>
</template>

<script setup lang="ts">
import GraphCanvas from '@/components/GraphCanvas.vue'
import { GraphEvents } from '@/core/graph/GraphEvents'
import { commandBus } from '@/core/command/CommandBus'
import { ref, onMounted } from 'vue'
import { BusinessService } from '@/core/services/BusinessService'
import { NodeRegistry } from '@/core/graph/NodeRegistry'
import { ResistorNode } from '@/core/nodes/components/ResistorNode'
import { CapacitorNode } from '@/core/nodes/components/CapacitorNode'

/** åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µç»Ÿä¸€æ³¨å†ŒèŠ‚ç‚¹ç±»å‹ï¼ˆæ–°å¢ç±»å‹åªéœ€åœ¨æ­¤æ³¨å†Œï¼‰ */
NodeRegistry.register('resistor', ResistorNode)
NodeRegistry.register('capacitor', CapacitorNode)

const bizService = new BusinessService()
const selected = ref<any | null>(null)

onMounted(() => {
  // ç›‘å¬æ¥è‡ª Graph çš„äº‹ä»¶ï¼ˆé€šè¿‡ GraphEvents è§£è€¦ï¼‰
  GraphEvents.on('node:click', ({ biz }) => {
    selected.value = {
      id: biz.id,
      type: biz.type,
      label: biz.label,
      payload: JSON.stringify(biz.payload ?? {}, null, 2)
    }
  })
})

function addResistor() {
  const id = crypto.randomUUID()
  commandBus.exec('node.add', {
    type: 'resistor',
    x: 60 + Math.random() * 200,
    y: 60 + Math.random() * 120,
    biz: { id, type: 'resistor', label: 'ç”µé˜» 10Î©', payload: { ohm: 10 } }
  })
}
function addCapacitor() {
  const id = crypto.randomUUID()
  commandBus.exec('node.add', {
    type: 'capacitor',
    x: 100 + Math.random() * 220,
    y: 100 + Math.random() * 160,
    biz: { id, type: 'capacitor', label: 'ç”µå®¹ 100uF', payload: { uf: 100 } }
  })
}
function save() {
  commandBus.exec('graph.save', undefined)
}
</script>

<style scoped>
.page { display: grid; grid-template-columns: 1fr 320px; gap: 12px; height: 100vh; padding: 12px; box-sizing: border-box; }
.left { display: grid; grid-template-rows: auto 1fr; gap: 8px; }
.toolbar { display: flex; gap: 8px; }
.right { border-left: 1px solid #eee; padding-left: 12px; overflow: auto; }
.row { display: grid; grid-template-columns: 80px 1fr; margin: 6px 0; }
.payload { background: #f8fafc; padding: 8px; border-radius: 6px; }
</style>
```

------

# 11) é™æ€èµ„æºï¼ˆç¤ºä¾‹å›¾æ ‡ï¼‰

æŠŠä½ çš„ SVG æ”¾åˆ° `public/icons/`ï¼š

```
public/icons/resistor.svg
public/icons/capacitor.svg
```

ï¼ˆä½ å¯æ›¿æ¢ä¸ºä»»ä½•å¼€æºå›¾æ ‡åº“çš„ SVGï¼šTabler/Lucide/Phosphor/Iconoir ç­‰ï¼ŒæŠŠè·¯å¾„æ”¾åˆ°èŠ‚ç‚¹ç±»çš„ `icon()` å³å¯ã€‚ï¼‰

------

# 12) ä¸€äº›å…³é”®è®¾è®¡ç‚¹ï¼ˆä¸ºä½•è§£è€¦ & æ€ä¹ˆæ‰©å±•ï¼‰

- **å¼•æ“è§£è€¦**ï¼šé¢†åŸŸèŠ‚ç‚¹ `BaseNode` â†’ äº§å‡ºâ€œå¼•æ“æ— å…³ç»“æ„â€ â†’ `X6Adapter` è´Ÿè´£æŠŠå®ƒç¿»è¯‘æˆ X6 çš„é…ç½®ã€‚æœªæ¥è‹¥æ¢å¼•æ“ï¼Œåªæ”¹ Adapter å±‚ã€‚
- **èŠ‚ç‚¹æ‰©å±•**ï¼šæ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹ = æ–°å»ºå­ç±»ï¼ˆå®šä¹‰ ports/icon/å°ºå¯¸/æ˜¾ç¤ºåï¼‰+ NodeRegistry æ³¨å†Œï¼›é¡µé¢æ— éœ€æ”¹å…¶ä»–é€»è¾‘ã€‚
- **ä¸šåŠ¡äº¤äº’**ï¼š`GraphEvents` æŠŠ X6 äº‹ä»¶è½¬ä¸ºä¸šåŠ¡äº‹ä»¶ï¼›é¡µé¢/ä¾§æ åªå…³å¿ƒ `BizData`ï¼Œä¸æ¥è§¦ X6 Nodeã€‚
- **å‘½ä»¤ä½“ç³»**ï¼š`CommandBus` ä½¿â€œè°ƒç”¨å›¾æ“ä½œâ€ç»Ÿä¸€èµ°å‘½ä»¤é€šé“ï¼›åœ¨ä¸­é—´ä»¶é‡Œå¯æŒ‚**æƒé™ã€åŸ‹ç‚¹ã€é”™è¯¯æ•è·**ã€‚
- **å¯æ’æ‹”æŒä¹…åŒ–**ï¼š`Persistence` æ¥å£é»˜è®¤ LocalStorageï¼Œéšæ—¶æ›¿æ¢ä¸º HTTP/S3/IndexedDBã€‚
- **è¿çº¿è§„åˆ™**ï¼š`createConnectingOptions()` é›†ä¸­ç®¡ç†ç«¯å£ç»„ä¸è¿æ¥æ ¡éªŒï¼ˆç¤ºä¾‹åªå…è®¸ `out â†’ in`ï¼‰ã€‚

æ²¡é—®é¢˜ï¼æˆ‘åœ¨ä½ ç°æœ‰çš„è§£è€¦æ¶æ„ä¸Šï¼Œä¸€æ¬¡æ€§æŠŠä½ è¦çš„ 1/2/3/4 éƒ½è¡¥é½ï¼š

1. **è‡ªå®šä¹‰ Vue ç»„ä»¶èŠ‚ç‚¹ï¼ˆå«å°å‹ä¸šåŠ¡è¡¨å• Mini-UIï¼‰**
2. **è¾¹æ ·å¼/è·¯ç”±/é”šç‚¹/å¸é™„å¯¹é½çº¿**
3. **Dagre è‡ªåŠ¨å¸ƒå±€ï¼ˆå‘½ä»¤è§¦å‘ï¼‰**
4. **å³é”®èœå• / å¿«æ·é”® / å†å²æ’¤é”€ / å°åœ°å›¾ / æ ‡å°ºï¼ˆå¯é€‰ï¼‰**

ä¸‹é¢ç»™å‡º**å¯ç›´æ¥æ‹·è´**çš„ä»£ç è¡¥ä¸ï¼Œå‡å«æ³¨é‡Šä¸”ä¿æŒâ€œ**é¢†åŸŸ â†’ é€‚é…å™¨**â€è§£è€¦ã€‚

------

# 0) ä¾èµ–è¡¥å……ï¼ˆå¯é€‰ä¾èµ–èµ°åŠ¨æ€å¯¼å…¥ï¼Œæœªå®‰è£…ä¹Ÿä¸å´©ï¼‰

```json
// package.jsonï¼ˆæ–°å¢/ç¡®è®¤ï¼‰
{
  "dependencies": {
    "@antv/x6": "^2.16.1",
    "@antv/layout": "^0.3.26",                // â‘¢ Dagre å¸ƒå±€ï¼ˆå¯é€‰ï¼‰
    "@antv/x6-plugin-minimap": "^2.2.4",      // â‘£ å°åœ°å›¾ï¼ˆå¯é€‰ï¼‰
    "mitt": "^3.0.1",
    "vue": "^3.4.0"
  }
}
```

> æ²¡è£…è¿™äº›â€œå¯é€‰â€æ’ä»¶æ—¶ï¼Œä»£ç ä¼šè‡ªåŠ¨é™çº§è¿è¡Œã€‚

------

# 1) è‡ªå®šä¹‰ Vue èŠ‚ç‚¹æ¸²æŸ“ï¼ˆMini-UIï¼‰

## 1.1 Vue èŠ‚ç‚¹ç»„ä»¶ï¼ˆä¸šåŠ¡å°å¡ç‰‡ + å†…è”å¯ç¼–è¾‘ï¼‰

```vue
<!-- src/nodes/ui/BusinessMiniCard.vue -->
<template>
  <div class="mini-wrap" @dblclick.stop="editing=true">
    <div class="row">
      <img :src="icon" class="ico" />
      <div class="title">{{ model.label }}</div>
    </div>

    <div class="kv">
      <label>å¤‡æ³¨</label>
      <template v-if="!editing">
        <span class="value">{{ model.payload?.note ?? 'â€”' }}</span>
      </template>
      <template v-else>
        <input v-model="draftNote" @keydown.enter.stop.prevent="save" />
        <button class="btn" @click.stop="save">ä¿å­˜</button>
      </template>
    </div>
  </div>
</template>

<script setup lang="ts">
/**
 * ä¸€ä¸ªæœ€å°çš„èŠ‚ç‚¹å†… UIï¼šæ”¯æŒåŒå‡»ç¼–è¾‘å¤‡æ³¨ï¼Œå¹¶æŠŠæ”¹åŠ¨å†™å› node.dataï¼ˆbiz æ•°æ®ï¼‰ã€‚
 * é€šè¿‡ props æ¥æ”¶ï¼šbizï¼ˆä¸šåŠ¡æ•°æ®ï¼‰ã€iconã€onUpdateï¼ˆå›å†™å‡½æ•°ï¼‰ã€‚
 */
import { ref, watch } from 'vue'

const props = defineProps<{
  biz: { id: string; type: string; label?: string; payload?: Record<string, any> }
  icon: string
  onUpdate: (next: any) => void
}>()

const editing = ref(false)
const model = ref({ ...props.biz })
const draftNote = ref(model.value.payload?.note ?? '')

watch(() => props.biz, (v) => {
  model.value = { ...v }
  draftNote.value = v.payload?.note ?? ''
})

function save() {
  const next = {
    ...model.value,
    payload: { ...(model.value.payload ?? {}), note: draftNote.value }
  }
  props.onUpdate(next)
  editing.value = false
}
</script>

<style scoped>
.mini-wrap { font: 12px/1.4 system-ui, -apple-system; width: 180px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; padding: 8px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
.row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.ico { width: 18px; height: 18px; }
.title { font-weight: 600; color: #111827; }
.kv { display: grid; grid-template-columns: 40px 1fr; align-items: center; gap: 8px; }
.kv label { color: #6b7280; }
.value { color: #111827; }
input { width: 100%; padding: 2px 6px; border: 1px solid #e5e7eb; border-radius: 4px; }
.btn { margin-left: 6px; padding: 2px 6px; border: 1px solid #e5e7eb; border-radius: 4px; background: #f9fafb; }
</style>
```

## 1.2 Vue èŠ‚ç‚¹æ¸²æŸ“å™¨ï¼šæŠŠ Vue ç»„ä»¶æŒ‚è¿› X6 HTML èŠ‚ç‚¹ï¼ˆforeignObjectï¼‰

```ts
// src/core/graph/VueNodeRenderer.ts
/**
 * ç”¨ X6 çš„ HTML ç»„ä»¶èƒ½åŠ›æŠŠ Vue ç»„ä»¶æŒ‚è¿›èŠ‚ç‚¹ã€‚
 * ä¿æŒâ€œé¢†åŸŸæ— å…³â€ï¼šä»…æ¥å— biz/iconï¼Œæ›´æ–°æ—¶é€šè¿‡å›è°ƒå†™å› node.dataã€‚
 */
import { createApp } from 'vue'
import type { Graph } from '@antv/x6'
import BusinessMiniCard from '@/nodes/ui/BusinessMiniCard.vue'

export function registerVueCard(graph: Graph) {
  // ä½¿ç”¨ X6 çš„ registerHTMLComponentï¼ˆ2.xï¼‰
  const Comp = graph.registerHTMLComponent((node) => {
    const wrap = document.createElement('div')
    const biz = node.getData() || {}
    const icon = node.getAttrByPath('image/xlink:href')

    const app = createApp(BusinessMiniCard, {
      biz,
      icon,
      onUpdate: (next: any) => {
        // å†™å› node.dataï¼Œå¹¶è§¦å‘è§†å›¾æ›´æ–°ï¼ˆå¤–éƒ¨é¢æ¿ä¹Ÿèƒ½æ”¶åˆ°ï¼‰
        node.setData(next, { overwrite: true })
      }
    })
    app.mount(wrap)

    // å½“èŠ‚ç‚¹è¢«é”€æ¯æ—¶è‡ªåŠ¨å¸è½½
    node.on('removed', () => app.unmount())
    return wrap
  })

  return Comp // ä½œä¸º shape çš„ html ç»„ä»¶å¼•ç”¨
}
```

## 1.3 é€‚é…å™¨æ‰©å±•ï¼šå½“èŠ‚ç‚¹å£°æ˜è¦ç”¨ Vue æ¸²æŸ“æ—¶ï¼Œè¾“å‡º html å½¢çŠ¶

```ts
// src/core/graph/X6Adapter.tsï¼ˆåœ¨åŸæ–‡ä»¶åŸºç¡€ä¸Šè¡¥å……ï¼‰
import type { PortSpec } from '../types'
import type { Graph } from '@antv/x6'
import { registerVueCard } from './VueNodeRenderer'

let registeredHtml: any | null = null

export function toX6NodeConfig(agnostic: {
  type: string
  position: { x: number; y: number }
  size: { width: number; height: number }
  label: string
  icon: string
  ports: PortSpec[]
  biz: any
  // æ–°å¢ï¼šæ˜¯å¦ç”¨ Vue æ¸²æŸ“ï¼ˆç”±é¢†åŸŸèŠ‚ç‚¹å†³å®šï¼‰
  renderAsVue?: boolean
}, graph?: Graph) {
  const { position, size, label, icon, ports, biz, renderAsVue } = agnostic

  const portGroups = {
    in:  { position: 'left'  as const, attrs: { circle: { r: 4, magnet: true } } },
    out: { position: 'right' as const, attrs: { circle: { r: 4, magnet: true } } }
  }

  if (renderAsVue && graph) {
    // â€”â€”Vue èŠ‚ç‚¹ï¼šç”¨ html shape æ‰¿è½½ï¼Œlabel äº¤ç»™ç»„ä»¶å†…éƒ¨ç®¡ç†
    if (!registeredHtml) registeredHtml = registerVueCard(graph)
    return {
      shape: 'html',
      x: position.x,
      y: position.y,
      width: size.width,
      height: size.height,
      data: biz,
      html: registeredHtml,
      attrs: {
        body: { stroke: '#64748b', fill: '#fff', rx: 8, ry: 8 },
        image: { 'xlink:href': icon } // ä¼ ç»™ç»„ä»¶ç”¨
      },
      ports: { groups: portGroups, items: ports.map(p => ({ id: p.id, group: p.group })) }
    }
  }

  // â€”â€”æ™®é€šèŠ‚ç‚¹ï¼šç”¨ rect + label + image
  return {
    shape: 'rect',
    x: position.x,
    y: position.y,
    width: size.width,
    height: size.height,
    data: biz,
    attrs: {
      body: { stroke: '#1f2937', fill: '#fff', rx: 6, ry: 6 },
      label: { text: label, fontSize: 12, refY: 0.5, refY2: 0 },
      image: { 'xlink:href': icon, width: 20, height: 20, x: 8, y: 14 }
    },
    ports: { groups: portGroups, items: ports.map(p => ({ id: p.id, group: p.group })) }
  }
}
```

> é¢†åŸŸèŠ‚ç‚¹è‹¥æƒ³å¯ç”¨ Vue æ¸²æŸ“ï¼Œåªéœ€åœ¨ `toEngineAgnostic()` ç»“æœé‡ŒåŠ  `renderAsVue: true`ã€‚

## 1.4 ç¤ºä¾‹ï¼šè®©ç”µé˜»èŠ‚ç‚¹ç”¨ Vue æ¸²æŸ“

```ts
// src/core/nodes/components/ResistorNode.tsï¼ˆåœ¨åŸæœ‰åŸºç¡€ä¸Šè¦†ç›– toEngineAgnosticï¼‰
import { BaseNode } from '../BaseNode'
import type { PortSpec } from '../../types'

export class ResistorNode extends BaseNode {
  displayName() { return this.biz.label ?? 'ç”µé˜»' }
  icon() { return '/icons/resistor.svg' }
  ports(): PortSpec[] {
    return [
      { id: `${this.biz.id}:in`, group: 'in' },
      { id: `${this.biz.id}:out`, group: 'out' },
    ]
  }
  // å…³é”®ï¼šå£°æ˜ renderAsVue
  toEngineAgnostic() {
    return {
      ...super.toEngineAgnostic(),
      renderAsVue: true
    }
  }
}
```

------

# 2) è¾¹æ ·å¼ / è·¯ç”± / é”šç‚¹ / å¸é™„å¯¹é½çº¿

```ts
// src/core/graph/X6Adapter.tsï¼ˆè¡¥å……ä¸€ä¸ªç»Ÿä¸€â€œè¿çº¿æ ·å¼/è·¯ç”±â€å·¥å‚ï¼‰
export function createConnectingOptions() {
  return {
    allowBlank: false,
    allowLoop: false,
    allowNode: false,
    highlight: true,
    snap: true,
    router: { name: 'manhattan' },         // ç›´è§’è·¯ç”±
    connector: { name: 'rounded', args: { radius: 6 } }, // åœ†è§’
    anchor: 'center',
    validateConnection({ sourcePort, targetPort }) {
      return !!(sourcePort?.id?.includes(':out') && targetPort?.id?.includes(':in'))
    },
    createEdge() {
      // ç»Ÿä¸€è¾¹çš„æ ·å¼ï¼ˆç®­å¤´ã€é¢œè‰²ã€å®½åº¦ï¼‰
      return {
        shape: 'edge',
        attrs: {
          line: {
            stroke: '#475569',
            strokeWidth: 1.6,
            targetMarker: { name: 'classic', size: 8 }
          }
        },
        zIndex: 1
      }
    }
  }
}
// src/core/graph/GraphManager.tsï¼ˆæ„é€ æ—¶å¯ç”¨å¸é™„çº¿/å¯¹é½ï¼‰
this.graph = new Graph({
  container: opts.container,
  grid: { size: 10, visible: true },
  panning: true,
  mousewheel: { enabled: true, modifiers: ['ctrl'] },
  connecting: createConnectingOptions(),
  selecting: { enabled: true, multiple: true, rubberband: true },
  history: { enabled: true },
  snapline: true             // å¯¹é½è¾…åŠ©çº¿
})
```

------

# 3) Dagre è‡ªåŠ¨å¸ƒå±€ï¼ˆå‘½ä»¤è§¦å‘ï¼Œæœªè£…ä¹Ÿä¸å´©ï¼‰

```ts
// src/core/command/layout.ts
/**
 * Command: graph.layout
 * ä½¿ç”¨ @antv/layout çš„ DagreLayout åš LR å¸ƒå±€
 * å¯é€šè¿‡ payload è¦†ç›– rankdir/nodesep/ranksepã€‚
 */
import type { Graph } from '@antv/x6'

export async function dagreLayout(graph: Graph, opts?: {
  rankdir?: 'LR' | 'TB' | 'RL' | 'BT'
  nodesep?: number
  ranksep?: number
}) {
  try {
    const mod = await import('@antv/layout')
    const Dagre = (mod as any).layout.DagreLayout
    const snap = graph.toJSON()

    const input = {
      nodes: snap.nodes.map((n: any) => ({
        id: n.id, width: n.size?.width ?? n.width ?? 120, height: n.size?.height ?? n.height ?? 40
      })),
      edges: snap.edges.map((e: any) => ({ source: e.source, target: e.target }))
    }

    const engine = new Dagre({
      rankdir: opts?.rankdir ?? 'LR',
      nodesep: opts?.nodesep ?? 40,
      ranksep: opts?.ranksep ?? 80
    })
    const res = engine.layout(input)
    const pos = new Map(res.nodes.map((n: any) => [n.id, { x: n.x, y: n.y }]))

    graph.batchUpdate(() => {
      graph.getNodes().forEach((node) => {
        const p = pos.get(node.id)
        if (p) node.position(p)
      })
    })
  } catch (e) {
    console.warn('[layout] @antv/layout æœªå®‰è£…ï¼Œè·³è¿‡å¸ƒå±€', e)
  }
}
```

åœ¨ `GraphCanvas.vue` åˆå§‹åŒ–å‘½ä»¤ï¼š

```ts
// src/components/GraphCanvas.vueï¼ˆonMounted å†…æ³¨å†Œå‘½ä»¤ï¼‰
import { dagreLayout } from '@/core/command/layout'

commandBus.register('graph.layout', (payload?: { rankdir?: any; nodesep?: number; ranksep?: number }) => {
  return dagreLayout(manager!.raw, payload)
})
```

åœ¨é¡µé¢ä¸Šç»‘å®šæŒ‰é’®ï¼š

```vue
<!-- src/views/DiagramEditor.vueï¼ˆå·¥å…·æ å¢åŠ å¸ƒå±€æŒ‰é’®ï¼‰ -->
<button @click="layout">â†” è‡ªåŠ¨å¸ƒå±€</button>

<script setup lang="ts">
function layout() {
  commandBus.exec('graph.layout', { rankdir: 'LR', nodesep: 40, ranksep: 80 })
}
</script>
```

------

# 4) å³é”®èœå• / å¿«æ·é”® / å†å²æ’¤é”€ / å°åœ°å›¾ / æ ‡å°º

## 4.1 å³é”®èœå•ï¼ˆå®Œå…¨è§£è€¦ï¼šç›‘å¬ GraphEventsï¼‰

```vue
<!-- src/components/ContextMenu.vue -->
<template>
  <div v-if="show" class="ctx" :style="{ left: x + 'px', top: y + 'px' }" @contextmenu.prevent>
    <div class="item" @click="emit('inspect')">æŸ¥çœ‹è¯¦æƒ…</div>
    <div class="item" @click="emit('edit')">ç¼–è¾‘æ ‡é¢˜</div>
    <div class="item danger" @click="emit('remove')">åˆ é™¤èŠ‚ç‚¹</div>
  </div>
</template>

<script setup lang="ts">
const props = defineProps<{ show: boolean; x: number; y: number }>()
const emit = defineEmits<{
  (e: 'inspect'): void
  (e: 'edit'): void
  (e: 'remove'): void
}>()
</script>

<style scoped>
.ctx { position: fixed; background: #fff; border: 1px solid #e5e7eb; border-radius: 6px; box-shadow: 0 8px 24px rgba(0,0,0,.08); min-width: 140px; z-index: 9999; }
.item { padding: 8px 12px; cursor: pointer; }
.item:hover { background: #f3f4f6; }
.danger { color: #b91c1c; }
</style>
```

åœ¨é¡µé¢é‡Œä½¿ç”¨ï¼š

```vue
<!-- src/views/DiagramEditor.vueï¼ˆç‰‡æ®µï¼‰ -->
<ContextMenu
  :show="menu.show" :x="menu.x" :y="menu.y"
  @inspect="inspect()" @edit="editTitle()" @remove="removeNode()" />

<script setup lang="ts">
import ContextMenu from '@/components/ContextMenu.vue'
import { GraphEvents } from '@/core/graph/GraphEvents'
import { commandBus } from '@/core/command/CommandBus'
import { ref, onMounted, onBeforeUnmount } from 'vue'

const menu = ref({ show: false, x: 0, y: 0, nodeId: '' })

onMounted(() => {
  const handler = (p: any) => {
    menu.value = { show: true, x: p.event.clientX, y: p.event.clientY, nodeId: p.id }
    window.addEventListener('click', closeMenu, { once: true })
  }
  GraphEvents.on('node:contextmenu', handler)
  onBeforeUnmount(() => GraphEvents.off('node:contextmenu', handler))
})

function closeMenu() { menu.value.show = false }

function inspect() {
  // ä½ å¯ä»¥æ‰“å¼€å³ä¾§é¢æ¿çš„â€œè¯¦ç»†æ¨¡å¼â€
  closeMenu()
}
function editTitle() {
  // ç®€åŒ–å®ç°ï¼šæŠŠ biz.label æ”¹æ‰ï¼ˆå®é™…å¯å¼¹æ¡†ï¼‰
  // é€šè¿‡å‘½ä»¤æŸ¥æ‰¾å¹¶å†™ node.dataï¼ˆè¿™é‡Œæ¼”ç¤ºç›´æ¥ç”¨ X6 API ä¹Ÿå¯ï¼‰
  closeMenu()
}
function removeNode() {
  commandBus.exec('node.delete', { id: menu.value.nodeId })
  closeMenu()
}
</script>
```

> ä¸‹é¢æ³¨å†Œ `node.delete` å‘½ä»¤ã€‚

## 4.2 å¿«æ·é”® + å†å²æ’¤é”€ï¼ˆCommandBus å°è£…ï¼‰

```ts
// src/core/command/builtin.ts
import type { Graph } from '@antv/x6'

export function registerBuiltinCommands(graph: Graph, bus: any) {
  bus.register('graph.undo', () => graph.history.undo())
  bus.register('graph.redo', () => graph.history.redo())
  bus.register('node.delete', ({ id }: { id?: string }) => {
    if (id) graph.getCellById(id)?.remove()
    else graph.removeCells(graph.getSelectedCells())
  })
  bus.register('graph.fit', () => graph.centerContent({ padding: 40 }))
}
```

åœ¨ `GraphCanvas.vue` åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼š

```ts
import { registerBuiltinCommands } from '@/core/command/builtin'

registerBuiltinCommands(manager.raw, commandBus)

// ç»‘å®šå¿«æ·é”®ï¼ˆæ— éœ€ X6 Keyboard æ’ä»¶ä¹Ÿèƒ½å·¥ä½œï¼‰
window.addEventListener('keydown', (e) => {
  const meta = e.ctrlKey || e.metaKey
  if (meta && e.key.toLowerCase() === 'z') { e.preventDefault(); commandBus.exec('graph.undo', undefined) }
  if ((meta && e.key.toLowerCase() === 'y') || (meta && e.shiftKey && e.key.toLowerCase() === 'z')) { e.preventDefault(); commandBus.exec('graph.redo', undefined) }
  if (e.key === 'Delete' || e.key === 'Backspace') { e.preventDefault(); commandBus.exec('node.delete', {}) }
  if (meta && e.key.toLowerCase() === 'f') { e.preventDefault(); commandBus.exec('graph.fit', undefined) }
})
```

## 4.3 å°åœ°å›¾ï¼ˆå¯é€‰æ’ä»¶ï¼Œè‡ªåŠ¨é™çº§ï¼‰

```ts
// src/core/graph/Minimap.ts
import type { Graph } from '@antv/x6'

export async function tryMountMinimap(graph: Graph, container: HTMLElement) {
  try {
    const { MiniMap } = await import('@antv/x6-plugin-minimap')
    graph.use(new MiniMap({ container, width: 200, height: 140 }))
  } catch (e) {
    console.warn('[minimap] æœªå®‰è£… @antv/x6-plugin-minimapï¼Œè·³è¿‡', e)
  }
}
```

é¡µé¢å®¹å™¨ï¼š

```vue
<!-- src/views/DiagramEditor.vue å·¥å…·æ ä¸‹æ–¹åŠ ä¸€ä¸ªå°åŒºåŸŸ -->
<div class="miniwrap"><div ref="mini" /></div>

<script setup lang="ts">
import { tryMountMinimap } from '@/core/graph/Minimap'
import { onMounted, ref } from 'vue'
const mini = ref<HTMLDivElement>()

// ç­‰ GraphCanvas åˆå§‹åŒ–å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ Global Bus/Ref æ‹¿åˆ° graph å®ä¾‹ï¼›
// è¿™é‡Œä¸ºç®€å•èµ·è§ï¼Œåœ¨ GraphCanvas å†…éƒ¨è°ƒç”¨ tryMountMinimap æ›´ç›´æ¥ï¼ˆè§ä¸‹ï¼‰ã€‚
</script>

<style scoped>
.miniwrap { position: absolute; right: 16px; bottom: 16px; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 6px; }
</style>
```

åœ¨ `GraphCanvas.vue` çš„ `onMounted` ä¸­ç›´æ¥æŒ‚è½½ï¼ˆæœ€ç®€å•ï¼‰ï¼š

```ts
import { tryMountMinimap } from '@/core/graph/Minimap'
// ...
await manager.load()
if (container.value) {
  const miniDiv = document.createElement('div')
  miniDiv.style.position = 'absolute'
  miniDiv.style.right = '12px'
  miniDiv.style.bottom = '12px'
  miniDiv.style.background = '#fff'
  miniDiv.style.border = '1px solid #e5e7eb'
  miniDiv.style.borderRadius = '8px'
  miniDiv.style.padding = '6px'
  container.value.appendChild(miniDiv)
  tryMountMinimap(manager.raw, miniDiv)
}
```

## 4.4 æ ‡å°ºï¼ˆè½»é‡å®ç°ï¼‰

X6 æ²¡æœ‰å®˜æ–¹â€œæ ‡å°ºâ€æ’ä»¶ã€‚ä¸ºä¿æŒè§£è€¦ï¼Œæˆ‘ä»¬åšä¸€ä¸ª**çº¯ DOM å åŠ **çš„è½»é‡æ ‡å°ºï¼ˆä¸ä¾èµ–å›¾å¼•æ“ï¼‰ï¼š

```vue
<!-- src/components/RulerOverlay.vue -->
<template>
  <div class="ruler-x" />
  <div class="ruler-y" />
</template>

<style scoped>
.ruler-x, .ruler-y { position: absolute; background-image: linear-gradient(to right, transparent 24px, #e5e7eb 24px), linear-gradient(to right, transparent 4px, #f1f5f9 4px); pointer-events: none; }
.ruler-x { top: 0; left: 0; right: 0; height: 24px; background-size: 25px 1px, 5px 1px; background-repeat: repeat-x; }
.ruler-y { top: 0; left: 0; bottom: 0; width: 24px; background-size: 1px 25px, 1px 5px; background-repeat: repeat-y; }
</style>
```

æŠŠå®ƒ**ç»å¯¹å®šä½**åˆ° Graph å®¹å™¨ä¸Šå±‚å³å¯ï¼ˆåœ¨ `GraphCanvas.vue` æ¨¡æ¿é‡ŒåŠ  `<RulerOverlay />`ï¼Œå®¹å™¨è®¾ `position: relative`ï¼‰ã€‚

------

# 5) æŠŠä¸€åˆ‡ä¸²èµ·æ¥ï¼ˆå…³é”®æ”¹åŠ¨æ±‡æ€»ï¼‰

### 5.1 GraphCanvas.vueï¼ˆå®Œæ•´ç‰‡æ®µï¼šæ–°å¢å°åœ°å›¾ã€å¿«æ·é”®ã€å‘½ä»¤ï¼‰

```vue
<!-- src/components/GraphCanvas.vue -->
<template>
  <div ref="container" class="graph-canvas">
    <RulerOverlay />
  </div>
</template>

<script setup lang="ts">
import { onMounted, ref } from 'vue'
import { GraphManager } from '@/core/graph/GraphManager'
import { LocalStoragePersistence } from '@/core/persistence/LocalStoragePersistence'
import { commandBus } from '@/core/command/CommandBus'
import { registerBuiltinCommands } from '@/core/command/builtin'
import { dagreLayout } from '@/core/command/layout'
import { tryMountMinimap } from '@/core/graph/Minimap'
import RulerOverlay from '@/components/RulerOverlay.vue'

const container = ref<HTMLDivElement>()
let manager: GraphManager

onMounted(async () => {
  if (!container.value) return
  container.value.style.position = 'relative' // ç»™ RulerOverlay ç»å¯¹å®šä½æä¾›å‚ç…§

  manager = new GraphManager({
    container: container.value,
    persistence: new LocalStoragePersistence(),
    diagramId: 'demo-diagram-001'
  })
  registerBuiltinCommands(manager.raw, commandBus)

  // å¯é€‰ï¼šåˆæ¬¡åŠ è½½
  await manager.load()

  // å¯é€‰ï¼šå°åœ°å›¾
  const miniDiv = document.createElement('div')
  miniDiv.style.position = 'absolute'
  miniDiv.style.right = '12px'
  miniDiv.style.bottom = '12px'
  miniDiv.style.background = '#fff'
  miniDiv.style.border = '1px solid #e5e7eb'
  miniDiv.style.borderRadius = '8px'
  miniDiv.style.padding = '6px'
  container.value.appendChild(miniDiv)
  tryMountMinimap(manager.raw, miniDiv)

  // å‘½ä»¤æ³¨å†Œï¼šæ–°å¢ã€ä¿å­˜ã€å¸ƒå±€
  commandBus.register('node.add', (p: { type: string; x: number; y: number; biz: any }) =>
    manager.addNode({ type: p.type, position: { x: p.x, y: p.y }, bizData: p.biz })
  )
  commandBus.register('graph.save', () => manager.save())
  commandBus.register('graph.layout', (payload?: any) => dagreLayout(manager.raw, payload))

  // å¿«æ·é”®
  window.addEventListener('keydown', (e) => {
    const meta = e.ctrlKey || e.metaKey
    if (meta && e.key.toLowerCase() === 'z') { e.preventDefault(); commandBus.exec('graph.undo', undefined) }
    if ((meta && e.key.toLowerCase() === 'y') || (meta && e.shiftKey && e.key.toLowerCase() === 'z')) { e.preventDefault(); commandBus.exec('graph.redo', undefined) }
    if (e.key === 'Delete' || e.key === 'Backspace') { e.preventDefault(); commandBus.exec('node.delete', {}) }
    if (meta && e.key.toLowerCase() === 'f') { e.preventDefault(); commandBus.exec('graph.fit', undefined) }
    if (meta && e.key.toLowerCase() === 'l') { e.preventDefault(); commandBus.exec('graph.layout', { rankdir: 'LR' }) }
  })
})
</script>

<style scoped>
.graph-canvas { width: 100%; height: 100%; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; }
</style>
```

### 5.2 DiagramEditor.vueï¼ˆå·¥å…·æ æ–°å¢æŒ‰é’®ã€å³é”®èœå•ï¼‰

```vue
<!-- src/views/DiagramEditor.vueï¼ˆå…³é”®ç‰‡æ®µï¼‰ -->
<div class="toolbar">
  <button @click="addResistor">+ ç”µé˜»(Vueæ¸²æŸ“)</button>
  <button @click="addCapacitor">+ ç”µå®¹</button>
  <button @click="layout">â†” å¸ƒå±€</button>
  <button @click="save">ğŸ’¾ ä¿å­˜</button>
</div>
<ContextMenu
  :show="menu.show" :x="menu.x" :y="menu.y"
  @inspect="inspect" @edit="editTitle" @remove="removeNode" />

<script setup lang="ts">
import ContextMenu from '@/components/ContextMenu.vue'
import { GraphEvents } from '@/core/graph/GraphEvents'
import { commandBus } from '@/core/command/CommandBus'
import { ref, onMounted } from 'vue'
import { NodeRegistry } from '@/core/graph/NodeRegistry'
import { ResistorNode } from '@/core/nodes/components/ResistorNode'
import { CapacitorNode } from '@/core/nodes/components/CapacitorNode'

NodeRegistry.register('resistor', ResistorNode)
NodeRegistry.register('capacitor', CapacitorNode)

const selected = ref<any | null>(null)
const menu = ref({ show: false, x: 0, y: 0, nodeId: '' })

onMounted(() => {
  GraphEvents.on('node:click', ({ biz }) => {
    selected.value = { ...biz, payload: JSON.stringify(biz.payload ?? {}, null, 2) }
  })
  GraphEvents.on('node:contextmenu', ({ id, event }) => {
    menu.value = { show: true, x: event.clientX, y: event.clientY, nodeId: id }
    window.addEventListener('click', () => (menu.value.show = false), { once: true })
  })
})

function addResistor() {
  commandBus.exec('node.add', {
    type: 'resistor',
    x: 80 + Math.random() * 200,
    y: 80 + Math.random() * 160,
    biz: { id: crypto.randomUUID(), type: 'resistor', label: 'ç”µé˜» 10Î©', payload: { ohm: 10, note: 'åŒå‡»èŠ‚ç‚¹å¯ç¼–è¾‘' } }
  })
}
function addCapacitor() {
  commandBus.exec('node.add', {
    type: 'capacitor',
    x: 120 + Math.random() * 200,
    y: 120 + Math.random() * 160,
    biz: { id: crypto.randomUUID(), type: 'capacitor', label: 'ç”µå®¹ 100uF', payload: { uf: 100 } }
  })
}
function layout()    { commandBus.exec('graph.layout', { rankdir: 'LR' }) }
function save()      { commandBus.exec('graph.save', undefined) }
function removeNode(){ commandBus.exec('node.delete', { id: menu.value.nodeId }) }

function inspect()   { /* æ‰“å¼€æ›´è¯¦ç»†çš„ä¸šåŠ¡æŠ½å±‰å³å¯ */ }
function editTitle() { /* å¼¹å‡ºè¾“å…¥æ¡†ï¼Œæ›´æ–° data.labelï¼›å¯ç”¨ GraphEvents+å‘½ä»¤å®ç° */ }
</script>
```

------

## ä½ ç°åœ¨æ‹¥æœ‰çš„èƒ½åŠ›æ¸…å•

- âœ… **Vue ç»„ä»¶åŒ–èŠ‚ç‚¹**ï¼ˆ`BusinessMiniCard`ï¼‰+ æ•°æ®å›å†™ï¼ˆ`node.setData`ï¼‰
- âœ… **ç»Ÿä¸€è¾¹æ ·å¼ / è·¯ç”± / é”šç‚¹ / å¸é™„å¯¹é½**ï¼ˆ`createConnectingOptions`ï¼‰
- âœ… **Dagre è‡ªåŠ¨å¸ƒå±€å‘½ä»¤**ï¼ˆ`graph.layout`ï¼‰
- âœ… **å³é”®èœå• / å¿«æ·é”® / å†å²æ’¤é”€ / å°åœ°å›¾ / è½»é‡æ ‡å°º**
- âœ… ä»ç„¶ä¿æŒï¼š**é¢†åŸŸèŠ‚ç‚¹ â†’ å¼•æ“æ— å…³ç»“æ„ â†’ X6 é€‚é…å™¨** çš„è§£è€¦è·¯å¾„

------

æ˜ç™½ âœ…ï¼Œä½ éœ€è¦ä¸€ä»½å¯ä»¥ç›´æ¥ç”¨äº **antv/x6 èŠ‚ç‚¹å›¾æ ‡**çš„ **å¼€æºå…ƒå™¨ä»¶ SVG å›¾æ ‡åº“**æ¨èã€‚æˆ‘å¸®ä½ æ•´ç†äº†å‡ ä¸ªæ–¹å‘ï¼Œéƒ½æ˜¯å¯ cloneã€å¯ç›´æ¥ç”¨çš„ï¼š

------

## ğŸ”Œ é€šç”¨å›¾æ ‡åº“ï¼ˆå¼€æºå…è´¹ï¼ŒSVG å¯ç›´æ¥ä½¿ç”¨ï¼‰

1. **Tabler Icons**
   - â­ [GitHub](https://github.com/tabler/tabler-icons)
   - è¶…è¿‡ **4600+** å…è´¹å¼€æº SVG å›¾æ ‡ï¼ŒMIT åè®®ã€‚
   - é£æ ¼ç»Ÿä¸€ï¼Œé€‚åˆä½œä¸ºç”µæ°”/æµç¨‹/é€šç”¨å…ƒå™¨ä»¶çš„åŸºç¡€å›¾æ ‡ã€‚
2. **Remix Icon**
   - â­ [GitHub](https://github.com/Remix-Design/RemixIcon)
   - é¢å‘äº§å“å’Œå·¥å…·çš„ç°ä»£åŒ–å›¾æ ‡é›†ï¼ŒSVG å¯ç›´æ¥æ‹¿æ¥å½“èŠ‚ç‚¹å›¾æ ‡ã€‚
3. **Heroicons**
   - â­ [GitHub](https://github.com/tailwindlabs/heroicons)
   - Tailwind å®˜æ–¹å‡ºå“ï¼ŒSVG/React/Vue ç‰ˆæœ¬éƒ½æœ‰ï¼Œå›¾æ ‡çº¿æ¡ç®€æ´ï¼Œé€‚åˆäº¤äº’å‹èŠ‚ç‚¹ã€‚

------

## âš¡ï¸ ä¸“é—¨çš„â€œå…ƒå™¨ä»¶ / ç”µæ°” / å·¥ç¨‹â€å›¾æ ‡åº“

1. **Material Design Icons (MDI)**
   - â­ [GitHub](https://github.com/Templarian/MaterialDesign)
   - åŒ…å«å¾ˆå¤šç”µå­ã€ç”µæ°”ã€ç¡¬ä»¶ç¬¦å·ï¼ˆç”µé˜»ã€ç”µå®¹ã€ç”µæ± ã€èŠ¯ç‰‡ã€äº‘æœåŠ¡ç­‰ï¼‰ã€‚
   - SVG å¯ç›´æ¥ç”¨ï¼Œç‰¹åˆ«é€‚åˆç”µæ°”ã€å·¥ä¸šèŠ‚ç‚¹ã€‚
2. **Openmoji**
   - â­ [GitHub](https://github.com/hfg-gmuend/openmoji)
   - è¶…è¿‡ **4000+** Emoji é£æ ¼çš„ SVG å›¾æ ‡ï¼ŒåŒ…å« **ç”µè·¯ç¬¦å·ã€å…ƒå™¨ä»¶ã€ç§‘å­¦è®¾å¤‡**ã€‚
   - é€‚åˆå¯è§†åŒ–åœºæ™¯ï¼Œé£æ ¼æ´»æ³¼ã€‚
3. **Lucide**ï¼ˆFeather Icons è¡ç”Ÿç‰ˆï¼‰
   - â­ [GitHub](https://github.com/lucide-icons/lucide)
   - å¤§é‡çº¿æ€§å›¾æ ‡ï¼Œå…¶ä¸­ä¹Ÿæœ‰è®¡ç®—æœº/ç½‘ç»œ/ç”µæ°”ç›¸å…³çš„ç¬¦å·ï¼Œè½»é‡å¯æ‰©å±•ã€‚

------

## ğŸ›  ä½¿ç”¨æ–¹å¼ï¼ˆåœ¨ X6 èŠ‚ç‚¹é‡ŒåŠ è½½ SVG å›¾æ ‡ï¼‰

å‡è®¾ä½ åœ¨ `assets/icons` ä¸‹å­˜æ”¾ `resistor.svg`ï¼ŒèŠ‚ç‚¹å®šä¹‰æ—¶è¿™æ ·ç”¨ï¼š

```ts
import { Graph } from '@antv/x6'

// åŠ è½½ svg å›¾æ ‡
import resistorIcon from '@/assets/icons/resistor.svg'

Graph.registerNode('resistor-node', {
  inherit: 'rect',
  width: 60,
  height: 40,
  attrs: {
    body: {
      stroke: '#333',
      fill: '#fff',
      rx: 6,
      ry: 6,
    },
    icon: {
      'xlink:href': resistorIcon, // SVG æ–‡ä»¶è·¯å¾„
      width: 24,
      height: 24,
      x: 18,
      y: 8,
    },
    label: {
      text: 'ç”µé˜»å™¨',
      fill: '#333',
      fontSize: 12,
      refY: 35,
    },
  },
})
```

è¿™æ ·ä½ å°±èƒ½å¿«é€ŸæŠŠ **SVG å›¾æ ‡åº“ â†’ X6 èŠ‚ç‚¹**ç»“åˆèµ·æ¥ã€‚

------

å½“ç„¶å¯ä»¥ ğŸ‘
 åœ¨ **antv/x6** é‡Œåšå¯æ‰©å±•è®¾è®¡æ—¶ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ **åŸºç±»èŠ‚ç‚¹**ï¼ˆBaseNodeï¼‰å’Œ**è¿æ¥æ¡©ï¼ˆportsï¼‰é…ç½®**ï¼Œç„¶ååœ¨å…¶åŸºç¡€ä¸Šæ‰©å±•ä¸åŒä¸šåŠ¡å›¾æ ·ã€‚ä¸‹é¢æˆ‘ç»™ä½ ä¸€ä¸ª Vue3 é¡¹ç›®ä¸­å¯ç›´æ¥å¤ç”¨çš„ä¾‹å­ï¼ˆä¸ä½ ä¹‹å‰éœ€è¦çš„â€œè§£è€¦ + æ‰©å±•æ€§å¥½â€ä¿æŒä¸€è‡´ï¼‰ã€‚

------

## 1. åŸºç±»èŠ‚ç‚¹ï¼ˆBaseNodeï¼‰

åŸºç±»èŠ‚ç‚¹å°è£…ä¸€äº›é€šç”¨å±æ€§ï¼ˆæ ·å¼ã€è¿æ¥æ¡©é…ç½®ã€ä¸šåŠ¡æ•°æ®å­—æ®µï¼‰ï¼Œæ‰€æœ‰ä¸šåŠ¡èŠ‚ç‚¹éƒ½ç»§æ‰¿å®ƒã€‚

```ts
// src/graph/nodes/BaseNode.ts
import { Shape } from '@antv/x6'

export const BaseNode = Shape.Rect.define({
  width: 120,
  height: 40,
  attrs: {
    body: {
      stroke: '#5F95FF',
      fill: '#EFF4FF',
      strokeWidth: 1,
    },
    label: {
      text: 'Base Node',
      fill: '#333',
      fontSize: 14,
    },
  },
  ports: {
    groups: {
      top: {
        position: 'top',
        attrs: {
          circle: {
            r: 4,
            magnet: true, // å…è®¸è¿æ¥
            stroke: '#5F95FF',
            strokeWidth: 1,
            fill: '#fff',
          },
        },
      },
      right: {
        position: 'right',
        attrs: {
          circle: {
            r: 4,
            magnet: true,
            stroke: '#5F95FF',
            strokeWidth: 1,
            fill: '#fff',
          },
        },
      },
      bottom: {
        position: 'bottom',
        attrs: {
          circle: {
            r: 4,
            magnet: true,
            stroke: '#5F95FF',
            strokeWidth: 1,
            fill: '#fff',
          },
        },
      },
      left: {
        position: 'left',
        attrs: {
          circle: {
            r: 4,
            magnet: true,
            stroke: '#5F95FF',
            strokeWidth: 1,
            fill: '#fff',
          },
        },
      },
    },
    items: [
      { id: 'port-top', group: 'top' },
      { id: 'port-right', group: 'right' },
      { id: 'port-bottom', group: 'bottom' },
      { id: 'port-left', group: 'left' },
    ],
  },
})
```

------

## 2. ä¸šåŠ¡èŠ‚ç‚¹ç¤ºä¾‹

åœ¨ `BaseNode` ä¸Šæ‰©å±•ï¼Œè®¾ç½®ä¸åŒå½¢çŠ¶ã€é¢œè‰²ã€ä¸šåŠ¡æ•°æ®ã€‚

```ts
// src/graph/nodes/TaskNode.ts
import { BaseNode } from './BaseNode'
import { Graph } from '@antv/x6'

// æ³¨å†Œä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼ˆç»§æ‰¿ BaseNodeï¼‰
Graph.registerNode(
  'task-node',
  {
    inherit: 'rect', // ç»§æ‰¿ rect åŸºç¡€å½¢çŠ¶
    width: 140,
    height: 50,
    attrs: {
      body: {
        stroke: '#13C2C2',
        fill: '#E6FFFB',
      },
      label: {
        text: 'ä»»åŠ¡èŠ‚ç‚¹',
        fontSize: 14,
        fill: '#006D75',
      },
    },
  },
  true
)
```

------

## 3. å†³ç­–èŠ‚ç‚¹ï¼ˆè±å½¢ï¼‰

å¯ä»¥å®šä¹‰ä¸åŒçš„å‡ ä½•å›¾æ ·ï¼Œæ¯”å¦‚å†³ç­–èŠ‚ç‚¹ç”¨è±å½¢ï¼š

```ts
// src/graph/nodes/DecisionNode.ts
import { Graph } from '@antv/x6'

Graph.registerNode(
  'decision-node',
  {
    inherit: 'polygon',
    width: 100,
    height: 60,
    attrs: {
      body: {
        stroke: '#FA8C16',
        fill: '#FFF7E6',
      },
      label: {
        text: 'æ¡ä»¶åˆ¤æ–­',
        fontSize: 14,
        fill: '#874D00',
      },
    },
    points: [
      [0, 30],
      [50, 0],
      [100, 30],
      [50, 60],
    ],
  },
  true
)
```

------

## 4. åœ¨ Graph ä¸­ä½¿ç”¨

```ts
// src/graph/initGraph.ts
import { Graph } from '@antv/x6'
import './nodes/BaseNode'
import './nodes/TaskNode'
import './nodes/DecisionNode'

export function initGraph(container: HTMLElement) {
  const graph = new Graph({
    container,
    grid: true,
    connecting: {
      allowBlank: false,
      allowLoop: false,
      highlight: true,
    },
  })

  // æ·»åŠ ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹
  graph.addNode({
    shape: 'task-node',
    x: 40,
    y: 40,
    data: { bizType: 'task', bizId: 1 },
  })

  // æ·»åŠ ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹
  graph.addNode({
    shape: 'decision-node',
    x: 240,
    y: 100,
    data: { bizType: 'decision', bizId: 2 },
  })

  return graph
}
```

------

## 5. Vue3 ç»„ä»¶æŒ‚è½½

```vue
<!-- src/components/GraphCanvas.vue -->
<template>
  <div ref="containerRef" style="width: 100%; height: 600px; border: 1px solid #ddd"></div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { initGraph } from '../graph/initGraph'

const containerRef = ref<HTMLDivElement>()

onMounted(() => {
  if (containerRef.value) {
    initGraph(containerRef.value)
  }
})
</script>
```

------

âœ… ä¸Šé¢è¿™å¥—ç»“æ„é‡Œï¼š

- **BaseNode** â†’ å®šä¹‰é€šç”¨æ ·å¼å’Œè¿æ¥æ¡©
- **TaskNode / DecisionNode** â†’ åŸºäº `Graph.registerNode` æ³¨å†Œä¸åŒç±»å‹ä¸šåŠ¡èŠ‚ç‚¹
- **initGraph** â†’ å•ç‹¬å°è£… `Graph` åˆå§‹åŒ–é€»è¾‘
- **GraphCanvas.vue** â†’ Vue3 ç»„ä»¶æŒ‚è½½

è¿™æ ·åšåˆ°äº† **è§£è€¦ & å¯æ‰©å±•**ï¼šä»¥ååªè¦åœ¨ `nodes/` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹å®šä¹‰æ–‡ä»¶å¹¶æ³¨å†Œå³å¯ã€‚

------

